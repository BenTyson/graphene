<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HGraphene Production Control</title>
  <link rel="stylesheet" href="/src/styles/main.css">
</head>
<body class="bg-white text-gray-900 font-sans">
  <div id="app" x-data="grapheneApp()">
    
    <!-- Header -->
    <header class="border-b border-gray-200 bg-white">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
          <h1 class="text-2xl font-bold tracking-tight">HGRAPHENE</h1>
          <div class="flex items-center space-x-4">
            <span class="text-sm text-gray-500" x-text="new Date().toLocaleDateString()"></span>
          </div>
        </div>
      </div>
    </header>

    <!-- Navigation Tabs -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-6">
      <div class="border-b border-gray-200">
        <nav class="-mb-px flex space-x-8">
          <button
            @click="activeTab = 'graphene'"
            :class="activeTab === 'graphene' ? 'border-black text-gray-900' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
            class="py-2 px-1 border-b-2 font-medium text-sm transition-colors"
          >
            Graphene
          </button>
          <button
            @click="activeTab = 'biochar'"
            :class="activeTab === 'biochar' ? 'border-black text-gray-900' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
            class="py-2 px-1 border-b-2 font-medium text-sm transition-colors"
          >
            Biochar
          </button>
          <button
            @click="activeTab = activeTab.startsWith('test-') ? activeTab : 'test-bet'"
            :class="activeTab.startsWith('test-') ? 'border-black text-gray-900' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
            class="py-2 px-1 border-b-2 font-medium text-sm transition-colors"
          >
            Test Results
          </button>
          <button
            @click="activeTab = 'updates'"
            :class="activeTab === 'updates' ? 'border-black text-gray-900' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
            class="py-2 px-1 border-b-2 font-medium text-sm transition-colors"
          >
            Curia Updates
          </button>
        </nav>
      </div>
    </div>
    
    <!-- Sub-navigation for Tests -->
    <div x-show="activeTab.startsWith('test-')" x-cloak class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="border-b border-gray-100 bg-gray-50">
        <nav class="flex space-x-6 px-2 py-3">
          <button
            @click="activeTab = 'test-bet'"
            :class="activeTab === 'test-bet' ? 'text-gray-900 font-medium' : 'text-gray-600 hover:text-gray-900'"
            class="text-sm transition-colors"
          >
            BET
          </button>
          <button
            @click="activeTab = 'test-conductivity'"
            :class="activeTab === 'test-conductivity' ? 'text-gray-900 font-medium' : 'text-gray-600 hover:text-gray-900'"
            class="text-sm transition-colors"
          >
            Conductivity
          </button>
          <button
            @click="activeTab = 'test-raman'"
            :class="activeTab === 'test-raman' ? 'text-gray-900 font-medium' : 'text-gray-600 hover:text-gray-900'"
            class="text-sm transition-colors"
          >
            RAMAN
          </button>
          <button
            @click="activeTab = 'test-sem'"
            :class="activeTab === 'test-sem' ? 'text-gray-900 font-medium' : 'text-gray-600 hover:text-gray-900'"
            class="text-sm transition-colors"
          >
            SEM Reports
          </button>
        </nav>
      </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- Biochar Tab -->
      <div x-show="activeTab === 'biochar'" x-cloak>
        <div class="mb-6 flex justify-between items-center">
          <h2 class="text-xl font-semibold">Biochar Production Records</h2>
          <div class="flex space-x-2">
            <button @click="exportData('biochar')" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">
              Export CSV
            </button>
            <button @click="showCombineModal = true" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50"
                    :class="{'opacity-50 cursor-not-allowed': biocharRecords.length === 0}"
                    :disabled="biocharRecords.length === 0">
              Combine into Lot
            </button>
            <button @click="biocharForm = {experimentNumber: '', testOrder: '', experimentDate: '', dateUnknown: false, researchTeam: 'Curia - Germany', reactor: '', rawMaterial: '', startingAmount: '', acidAmount: '', acidConcentration: '', acidMolarity: '', acidType: '', temperature: '', time: '', pressureInitial: '', pressureFinal: '', washAmount: '', washMedium: '', output: '', dryingTemp: '', kftPercentage: '', comments: ''}; editingBiochar = null; showAddBiochar = true" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">
              Add Record
            </button>
          </div>
        </div>

        <!-- Search Bar -->
        <div class="mb-4">
          <input
            type="text"
            x-model="biocharSearch"
            @input="searchBiochar()"
            placeholder="Search experiments, materials..."
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black"
          >
        </div>

        <!-- Biochar Table -->
        <div class="overflow-x-auto border border-gray-200 rounded-lg">
          <table class="min-w-full divide-y divide-gray-200">
            <thead>
              <!-- Main Header Row -->
              <tr class="bg-gray-100">
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Select</th>
                <th colspan="4" class="px-2 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Basic Info</th>
                <th colspan="2" class="px-2 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Material</th>
                <th colspan="8" class="px-2 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Process</th>
                <th colspan="5" class="px-2 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Output</th>
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Lot #</th>
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Actions</th>
              </tr>
              <!-- Sub-Header Row -->
              <tr class="bg-gray-50">
                <!-- Basic Info sub-headers -->
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">
                  <button @click="sortBiochar('testOrder')" class="flex items-center hover:text-gray-700">
                    Order
                    <span x-html="getSortIcon('testOrder')"></span>
                  </button>
                </th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">
                  <button @click="sortBiochar('experimentNumber')" class="flex items-center hover:text-gray-700">
                    Exp #
                    <span x-html="getSortIcon('experimentNumber')"></span>
                  </button>
                </th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">
                  <button @click="sortBiochar('experimentDate')" class="flex items-center hover:text-gray-700">
                    Date
                    <span x-html="getSortIcon('experimentDate')"></span>
                  </button>
                </th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-300">
                  <button @click="sortBiochar('reactor')" class="flex items-center hover:text-gray-700">
                    Reactor
                    <span x-html="getSortIcon('reactor')"></span>
                  </button>
                </th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">
                  <button @click="sortBiochar('rawMaterial')" class="flex items-center hover:text-gray-700">
                    Raw Material
                    <span x-html="getSortIcon('rawMaterial')"></span>
                  </button>
                </th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-300">
                  <button @click="sortBiochar('startingAmount')" class="flex items-center hover:text-gray-700">
                    Start (g)
                    <span x-html="getSortIcon('startingAmount')"></span>
                  </button>
                </th>
                <!-- Process sub-headers -->
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Acid Amt</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Acid %</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Molarity</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Acid Type</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">
                  <button @click="sortBiochar('temperature')" class="flex items-center hover:text-gray-700">
                    Temp
                    <span x-html="getSortIcon('temperature')"></span>
                  </button>
                </th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">
                  <button @click="sortBiochar('time')" class="flex items-center hover:text-gray-700">
                    Time
                    <span x-html="getSortIcon('time')"></span>
                  </button>
                </th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">P Initial</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-300">P Final</th>
                <!-- Output sub-headers -->
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Wash Amt</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Wash Med</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Drying</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">
                  <button @click="sortBiochar('output')" class="flex items-center hover:text-gray-700">
                    Output (g)
                    <span x-html="getSortIcon('output')"></span>
                  </button>
                </th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-300">KFT %</th>
              </tr>
            </thead>
            <!-- Each record gets its own tbody containing both main and expandable rows -->
            <template x-for="record in biocharRecords" :key="record.id">
              <tbody class="bg-white divide-y divide-gray-200">
                <tr class="hover:bg-gray-50" :class="{'bg-link-light': record.lotNumber}">
                  <!-- Select checkbox -->
                  <td class="px-2 py-2 text-xs border-r border-gray-300">
                    <input type="checkbox" x-model="selectedBiocharIds" :value="record.id" 
                           :disabled="record.lotNumber"
                           class="rounded border-gray-300" 
                           :class="{'opacity-50 cursor-not-allowed': record.lotNumber}">
                  </td>
                  <!-- Basic Info columns -->
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.testOrder || '-'"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200">
                    <button 
                      @click="toggleBiocharExpansion(record.experimentNumber)" 
                      class="text-link text-link-hover underline cursor-pointer font-bold"
                      x-text="record.experimentNumber">
                    </button>
                  </td>
                  <td class="px-2 py-2 text-xs border-r border-gray-200" x-text="formatDate(record.experimentDate)"></td>
                  <td class="px-2 py-2 text-xs border-r border-gray-300" x-text="record.reactor"></td>
                  <!-- Material columns -->
                  <td class="px-2 py-2 text-xs border-r border-gray-200" x-text="record.rawMaterial"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-300" x-text="record.startingAmount ? record.startingAmount + 'g' : ''"></td>
                  <!-- Process columns -->
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.acidAmount ? record.acidAmount + 'g' : ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.acidConcentration ? record.acidConcentration + '%' : ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.acidMolarity ? record.acidMolarity + 'M' : ''"></td>
                  <td class="px-2 py-2 text-xs border-r border-gray-200" x-text="record.acidType || ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.temperature ? record.temperature + '°C' : ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.time ? record.time + 'hr' : ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.pressureInitial ? record.pressureInitial + ' bar' : ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-300" x-text="record.pressureFinal ? record.pressureFinal + ' bar' : ''"></td>
                  <!-- Output columns -->
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.washAmount ? record.washAmount + 'g' : ''"></td>
                  <td class="px-2 py-2 text-xs border-r border-gray-200" x-text="record.washMedium || ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.dryingTemp ? record.dryingTemp + '°C' : ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.output ? record.output + 'g' : ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-300" x-text="record.kftPercentage ? record.kftPercentage + '%' : ''"></td>
                  <!-- Lot Number -->
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-300">
                    <span x-text="record.lotNumber || ''" 
                          :class="{'text-link font-semibold': record.lotNumber}"></span>
                  </td>
                  <!-- Actions -->
                  <td class="px-2 py-2 text-xs">
                    <div class="flex items-center space-x-1">
                      <template x-if="record.comments">
                        <div class="relative group">
                          <svg class="w-4 h-4 text-gray-400 hover:text-gray-600 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path>
                          </svg>
                          <div class="absolute bottom-full left-0 mb-1 hidden group-hover:block z-10 w-48 p-2 bg-gray-900 text-white text-xs rounded shadow-lg">
                            <span x-text="record.comments"></span>
                          </div>
                        </div>
                      </template>
                      <button @click="copyBiochar(record)" class="text-link text-link-hover text-xs">Copy</button>
                      <button @click="editBiochar(record)" class="text-gray-600 hover:text-gray-900 text-xs">Edit</button>
                      <button @click="deleteBiochar(record.id)" class="text-red-600 hover:text-red-900 text-xs">Delete</button>
                    </div>
                  </td>
                </tr>
                
                <!-- Expandable Related Data Row - Directly below the main row -->
                <tr x-show="expandedBiocharRows[record.experimentNumber]" 
                    x-transition:enter="transition ease-out duration-200"
                    x-transition:enter-start="opacity-0 transform scale-95"
                    x-transition:enter-end="opacity-100 transform scale-100"
                    x-transition:leave="transition ease-in duration-150"
                    x-transition:leave-start="opacity-100 transform scale-100"
                    x-transition:leave-end="opacity-0 transform scale-95"
                    class="bg-gray-50">
                  <td colspan="21" class="px-4 py-4">
                    <div class="bg-white border border-gray-300 rounded-lg p-4">
                      <h3 class="text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2 mb-4">
                        Material Journey: <span class="font-mono text-black" x-text="record.experimentNumber"></span>
                      </h3>
                      
                      <div x-show="loadingBiocharRelated[record.experimentNumber]" class="text-center text-gray-500">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto"></div>
                        <p class="mt-2">Loading related data...</p>
                      </div>
                      
                      <div x-show="!loadingBiocharRelated[record.experimentNumber] && biocharRelatedData[record.experimentNumber]" class="space-y-4">
                        
                        <!-- Direct Graphene Productions -->
                        <div x-show="biocharRelatedData[record.experimentNumber] && biocharRelatedData[record.experimentNumber].directGraphene && biocharRelatedData[record.experimentNumber].directGraphene.length > 0">
                          <h4 class="text-sm font-semibold text-gray-700 mb-2 flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                            </svg>
                            Direct Graphene Productions
                          </h4>
                        <div class="overflow-x-auto">
                          <table class="min-w-full text-xs border border-gray-200">
                            <thead class="bg-gray-100">
                              <tr>
                                <th class="px-2 py-1 text-left">Exp #</th>
                                <th class="px-2 py-1 text-left">Date</th>
                                <th class="px-2 py-1 text-left">Oven</th>
                                <th class="px-2 py-1 text-left">Quantity (g)</th>
                                <th class="px-2 py-1 text-left">Species</th>
                                <th class="px-2 py-1 text-left">Output (g)</th>
                              </tr>
                            </thead>
                            <tbody>
                              <template x-for="graphene in (biocharRelatedData[record.experimentNumber] && biocharRelatedData[record.experimentNumber].directGraphene) || []" :key="graphene.id">
                                <tr class="border-t border-gray-200">
                                  <td class="px-2 py-1 font-mono" x-text="graphene.experimentNumber"></td>
                                  <td class="px-2 py-1" x-text="formatDate(graphene.experimentDate)"></td>
                                  <td class="px-2 py-1" x-text="graphene.oven"></td>
                                  <td class="px-2 py-1" x-text="graphene.quantity ? graphene.quantity + 'g' : ''"></td>
                                  <td class="px-2 py-1" x-text="graphene.species"></td>
                                  <td class="px-2 py-1" x-text="graphene.output ? graphene.output + 'g' : ''"></td>
                                </tr>
                              </template>
                            </tbody>
                          </table>
                        </div>
                      </div>

                      <!-- Lot-based Graphene Productions -->
                      <div x-show="biocharRelatedData[record.experimentNumber] && biocharRelatedData[record.experimentNumber].lotGraphene && biocharRelatedData[record.experimentNumber].lotGraphene.length > 0">
                        <h4 class="text-sm font-semibold text-gray-700 mb-2 flex items-center">
                          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                          </svg>
                          Lot-based Graphene Productions 
                          <span class="text-gray-500 font-normal ml-2">(from lot: <span x-text="biocharRelatedData[record.experimentNumber] && biocharRelatedData[record.experimentNumber].lotNumber"></span>)</span>
                        </h4>
                        <div class="overflow-x-auto">
                          <table class="min-w-full text-xs border border-gray-200">
                            <thead class="bg-gray-100">
                              <tr>
                                <th class="px-2 py-1 text-left">Exp #</th>
                                <th class="px-2 py-1 text-left">Date</th>
                                <th class="px-2 py-1 text-left">Oven</th>
                                <th class="px-2 py-1 text-left">Quantity (g)</th>
                                <th class="px-2 py-1 text-left">Species</th>
                                <th class="px-2 py-1 text-left">Output (g)</th>
                              </tr>
                            </thead>
                            <tbody>
                              <template x-for="graphene in (biocharRelatedData[record.experimentNumber] && biocharRelatedData[record.experimentNumber].lotGraphene) || []" :key="graphene.id">
                                <tr class="border-t border-gray-200">
                                  <td class="px-2 py-1 font-mono" x-text="graphene.experimentNumber"></td>
                                  <td class="px-2 py-1" x-text="formatDate(graphene.experimentDate)"></td>
                                  <td class="px-2 py-1" x-text="graphene.oven"></td>
                                  <td class="px-2 py-1" x-text="graphene.quantity ? graphene.quantity + 'g' : ''"></td>
                                  <td class="px-2 py-1" x-text="graphene.species"></td>
                                  <td class="px-2 py-1" x-text="graphene.output ? graphene.output + 'g' : ''"></td>
                                </tr>
                              </template>
                            </tbody>
                          </table>
                        </div>
                      </div>

                      <!-- BET Tests -->
                      <div x-show="biocharRelatedData[record.experimentNumber] && biocharRelatedData[record.experimentNumber].betTests && biocharRelatedData[record.experimentNumber].betTests.length > 0">
                        <h4 class="text-sm font-semibold text-gray-700 mb-2 flex items-center">
                          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                          </svg>
                          BET Surface Area Tests
                        </h4>
                        <div class="overflow-x-auto">
                          <table class="min-w-full text-xs border border-gray-200">
                            <thead class="bg-gray-100">
                              <tr>
                                <th class="px-2 py-1 text-left">Test Date</th>
                                <th class="px-2 py-1 text-left">Graphene Sample</th>
                                <th class="px-2 py-1 text-left">BET Area (m²/g)</th>
                                <th class="px-2 py-1 text-left">Langmuir Area (m²/g)</th>
                                <th class="px-2 py-1 text-left">Species</th>
                              </tr>
                            </thead>
                            <tbody>
                              <template x-for="bet in (biocharRelatedData[record.experimentNumber] && biocharRelatedData[record.experimentNumber].betTests) || []" :key="bet.id">
                                <tr class="border-t border-gray-200">
                                  <td class="px-2 py-1" x-text="formatDate(bet.testDate)"></td>
                                  <td class="px-2 py-1 font-mono" x-text="bet.grapheneSample"></td>
                                  <td class="px-2 py-1 font-mono" x-text="bet.multipointBetArea ? formatScientific(bet.multipointBetArea) : ''"></td>
                                  <td class="px-2 py-1 font-mono" x-text="bet.langmuirSurfaceArea ? formatScientific(bet.langmuirSurfaceArea) : ''"></td>
                                  <td class="px-2 py-1" x-text="bet.species"></td>
                                </tr>
                              </template>
                            </tbody>
                          </table>
                        </div>
                      </div>

                      <!-- No Related Data Message -->
                        <div x-show="biocharRelatedData[record.experimentNumber] &&
                                     (!biocharRelatedData[record.experimentNumber].directGraphene || !biocharRelatedData[record.experimentNumber].directGraphene.length) && 
                                     (!biocharRelatedData[record.experimentNumber].lotGraphene || !biocharRelatedData[record.experimentNumber].lotGraphene.length) && 
                                     (!biocharRelatedData[record.experimentNumber].betTests || !biocharRelatedData[record.experimentNumber].betTests.length)" 
                             class="text-center text-gray-500 py-4">
                          No related graphene or BET data found for this biochar experiment.
                        </div>
                        
                      </div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </template>
          </table>
        </div>
      </div>

      <!-- Graphene Tab -->
      <div x-show="activeTab === 'graphene'" x-cloak>
        <div class="mb-6 flex justify-between items-center">
          <h2 class="text-xl font-semibold">Graphene Production Records</h2>
          <div class="flex space-x-2">
            <button @click="exportData('graphene')" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">
              Export CSV
            </button>
            <button @click="grapheneForm = {experimentNumber: '', titleNote: '', testOrder: '', experimentDate: '', dateUnknown: false, researchTeam: 'Curia - Germany', oven: '', quantity: '', biocharExperiment: '', biocharLotNumber: '', biocharSource: '', baseAmount: '', baseType: '', baseConcentration: '', base2Amount: '', base2Type: '', base2Concentration: '', grindingMethod: '', grindingTime: '', grindingFrequency: '', homogeneous: '', gas: '', tempRate: '', tempMax: '', time: '', washAmount: '', washSolution: '', washConcentration: '', washWater: '', dryingTemp: '', dryingAtmosphere: '', dryingPressure: 'atm. Pressure', volumeMl: '', density: '', species: '', appearanceTags: [], semReportFile: null, removeSemReport: false, replaceSemReport: false, output: '', comments: ''}; editingGraphene = null; showAddGraphene = true" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">
              Add Record
            </button>
          </div>
        </div>

        <!-- Search Bar -->
        <div class="mb-4">
          <input
            type="text"
            x-model="grapheneSearch"
            @input="searchGraphene()"
            placeholder="Search experiments, biochar source, species..."
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black"
          >
        </div>

        <!-- Graphene Table -->
        <div class="overflow-x-auto border border-gray-200 rounded-lg">
          <table class="min-w-full divide-y divide-gray-200">
            <thead>
              <!-- Main Header Row -->
              <tr class="bg-gray-100">
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">
                  <button @click="sortGraphene('testOrder')" class="flex items-center hover:text-gray-800">
                    Order
                    <span x-html="getSortIcon('testOrder')"></span>
                  </button>
                </th>
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">
                  <button @click="sortGraphene('experimentNumber')" class="flex items-center hover:text-gray-800">
                    Exp #
                    <span x-html="getSortIcon('experimentNumber')"></span>
                  </button>
                </th>
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">
                  <button @click="sortGraphene('experimentDate')" class="flex items-center hover:text-gray-800">
                    Date
                    <span x-html="getSortIcon('experimentDate')"></span>
                  </button>
                </th>
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">
                  <button @click="sortGraphene('oven')" class="flex items-center hover:text-gray-800">
                    Oven
                    <span x-html="getSortIcon('oven')"></span>
                  </button>
                </th>
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">
                  <button @click="sortGraphene('quantity')" class="flex items-center hover:text-gray-800">
                    Qty (g)
                    <span x-html="getSortIcon('quantity')"></span>
                  </button>
                </th>
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">
                  <button @click="sortGraphene('biocharExperiment')" class="flex items-center hover:text-gray-800">
                    Biochar
                    <span x-html="getSortIcon('biocharExperiment')"></span>
                  </button>
                </th>
                <th colspan="3" class="px-2 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Base</th>
                <th colspan="3" class="px-2 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Grinding</th>
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Homog.</th>
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Gas</th>
                <th colspan="3" class="px-2 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Temperature</th>
                <th colspan="4" class="px-2 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Wash</th>
                <th colspan="3" class="px-2 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Drying</th>
                <th colspan="4" class="px-2 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Results</th>
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">
                  <button @click="sortGraphene('species')" class="flex items-center hover:text-gray-800">
                    Species
                    <span x-html="getSortIcon('species')"></span>
                  </button>
                </th>
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Appearance</th>
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Actions</th>
              </tr>
              <!-- Sub-Header Row -->
              <tr class="bg-gray-50">
                <!-- Base sub-headers -->
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Amt</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Type</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-300">Conc%</th>
                <!-- Grinding sub-headers -->
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Method</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Time</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-300">Freq</th>
                <!-- Temperature sub-headers -->
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">
                  <button @click="sortGraphene('tempRate')" class="flex items-center hover:text-gray-700">
                    Rate
                    <span x-html="getSortIcon('tempRate')"></span>
                  </button>
                </th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">
                  <button @click="sortGraphene('tempMax')" class="flex items-center hover:text-gray-700">
                    Max
                    <span x-html="getSortIcon('tempMax')"></span>
                  </button>
                </th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-300">
                  <button @click="sortGraphene('time')" class="flex items-center hover:text-gray-700">
                    Time
                    <span x-html="getSortIcon('time')"></span>
                  </button>
                </th>
                <!-- Wash sub-headers -->
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Amt</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Sol.</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Conc%</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-300">Water</th>
                <!-- Drying sub-headers -->
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Temp</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Atm.</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-300">Press.</th>
                <!-- Results sub-headers -->
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">
                  <button @click="sortGraphene('volumeMl')" class="flex items-center hover:text-gray-700">
                    Vol(ml)
                    <span x-html="getSortIcon('volumeMl')"></span>
                  </button>
                </th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Dens.</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">
                  <button @click="sortGraphene('output')" class="flex items-center hover:text-gray-700">
                    Out(g)
                    <span x-html="getSortIcon('output')"></span>
                  </button>
                </th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-300">Out%</th>
              </tr>
            </thead>
            <!-- Each record gets its own tbody containing both main and expandable rows -->
            <template x-for="record in grapheneRecords" :key="record.id">
              <tbody class="bg-white divide-y divide-gray-200">
                <tr class="hover:bg-gray-50">
                  <!-- Basic info -->
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.testOrder || '-'"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200">
                    <button 
                      @click="toggleGrapheneExpansion(record.experimentNumber)" 
                      class="text-link text-link-hover underline cursor-pointer">
                      <span x-text="record.experimentNumber" class="font-bold"></span>
                      <span x-show="record.titleNote" x-text="' ' + record.titleNote" class="text-gray-600"></span>
                    </button>
                  </td>
                  <td class="px-2 py-2 text-xs border-r border-gray-200" x-text="formatDate(record.experimentDate)"></td>
                  <td class="px-2 py-2 text-xs border-r border-gray-200" x-text="record.oven"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.quantity ? record.quantity + 'g' : ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-300">
                    <span x-text="record.biocharExperiment || (record.biocharLotNumber ? 'LOT: ' + record.biocharLotNumber : (!record.biocharExperiment && !record.biocharLotNumber ? 'Various' : ''))"
                          :class="{'text-link font-semibold': record.biocharLotNumber, 'text-gray-500 italic': !record.biocharExperiment && !record.biocharLotNumber}"></span>
                  </td>
                  <!-- Base columns -->
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200">
                    <span x-text="record.baseAmount ? record.baseAmount + 'g' : ''"></span>
                    <span x-show="record.base2Amount" x-text="' + ' + record.base2Amount + 'g'" class="text-gray-500"></span>
                  </td>
                  <td class="px-2 py-2 text-xs border-r border-gray-200">
                    <span x-text="record.baseType"></span>
                    <span x-show="record.base2Type" x-text="' + ' + record.base2Type" class="text-gray-500"></span>
                  </td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-300">
                    <span x-text="record.baseConcentration ? record.baseConcentration + '%' : ''"></span>
                    <span x-show="record.base2Concentration" x-text="' + ' + record.base2Concentration + '%'" class="text-gray-500"></span>
                  </td>
                  <!-- Grinding columns -->
                  <td class="px-2 py-2 text-xs border-r border-gray-200" x-text="record.grindingMethod"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.grindingTime ? record.grindingTime + 'min' : ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-300" x-text="record.grindingFrequency ? record.grindingFrequency + 'Hz' : ''"></td>
                  <!-- Homogeneous -->
                  <td class="px-2 py-2 text-xs border-r border-gray-300" x-text="record.homogeneous !== null ? (record.homogeneous ? 'Yes' : 'No') : ''"></td>
                  <!-- Gas -->
                  <td class="px-2 py-2 text-xs border-r border-gray-300" x-text="record.gas"></td>
                  <!-- Temperature columns -->
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.tempRate ? record.tempRate + '°C/min' : ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.tempMax ? record.tempMax + '°C' : ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-300" x-text="record.time ? record.time + 'hr' : ''"></td>
                  <!-- Wash columns -->
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.washAmount ? record.washAmount + 'g' : ''"></td>
                  <td class="px-2 py-2 text-xs border-r border-gray-200" x-text="record.washSolution"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.washConcentration ? record.washConcentration + '%' : ''"></td>
                  <td class="px-2 py-2 text-xs border-r border-gray-300" x-text="record.washWater"></td>
                  <!-- Drying columns -->
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.dryingTemp ? record.dryingTemp + '°C' : ''"></td>
                  <td class="px-2 py-2 text-xs border-r border-gray-200" x-text="record.dryingAtmosphere"></td>
                  <td class="px-2 py-2 text-xs border-r border-gray-300" x-text="record.dryingPressure"></td>
                  <!-- Results columns -->
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.volumeMl ? record.volumeMl + 'ml' : ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="(record.volumeMl && record.output) ? (record.volumeMl / record.output).toFixed(2) + ' ml/g' : ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.output ? record.output + 'g' : ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-300" x-text="calculateOutputPercentage(record)"></td>
                  <!-- Species & Appearance -->
                  <td class="px-2 py-2 text-xs border-r border-gray-300" x-text="record.species"></td>
                  <td class="px-2 py-2 text-xs border-r border-gray-300" x-text="formatAppearanceTags(record.appearanceTags)"></td>
                  <!-- Actions -->
                  <td class="px-2 py-2 text-xs">
                    <div class="flex items-center space-x-1">
                      <template x-if="record.comments">
                        <div class="relative group">
                          <svg class="w-4 h-4 text-gray-400 hover:text-gray-600 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path>
                          </svg>
                          <div class="absolute bottom-full left-0 mb-1 hidden group-hover:block z-10 w-48 p-2 bg-gray-900 text-white text-xs rounded shadow-lg">
                            <span x-text="record.comments"></span>
                          </div>
                        </div>
                      </template>
                      <button x-show="record.semReportPath" @click="viewSemReport(record.semReportPath)" class="text-link text-link-hover text-xs mr-2">View SEM</button>
                      <button @click="copyGraphene(record)" class="text-link text-link-hover text-xs">Copy</button>
                      <button @click="editGraphene(record)" class="text-gray-600 hover:text-gray-900 text-xs">Edit</button>
                      <button @click="deleteGraphene(record.id)" class="text-red-600 hover:text-red-900 text-xs">Delete</button>
                    </div>
                  </td>
                </tr>
                
                <!-- Expandable Related Data Row - Directly below the main row -->
                <tr x-show="expandedGrapheneRows[record.experimentNumber]" 
                    x-transition:enter="transition ease-out duration-200"
                    x-transition:enter-start="opacity-0 transform scale-95"
                    x-transition:enter-end="opacity-100 transform scale-100"
                    x-transition:leave="transition ease-in duration-150"
                    x-transition:leave-start="opacity-100 transform scale-100"
                    x-transition:leave-end="opacity-0 transform scale-95"
                    class="bg-gray-50">
                  <td colspan="28" class="px-4 py-4">
                    <div class="bg-white border border-gray-300 rounded-lg p-4 space-y-4">
                      <h3 class="text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2">
                        Material Journey: <span class="font-mono text-black" x-text="record.experimentNumber"></span>
                        <span x-show="record.titleNote" x-text="record.titleNote" class="text-gray-600 font-normal"></span>
                      </h3>
                      
                      <template x-if="loadingGrapheneRelated[record.experimentNumber]">
                        <div class="text-center py-4">
                          <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto"></div>
                          <p class="mt-2 text-gray-600">Loading related data...</p>
                        </div>
                      </template>
                      
                      <template x-if="!loadingGrapheneRelated[record.experimentNumber] && grapheneRelatedData[record.experimentNumber]">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                          <!-- Source Biochar Data -->
                          <div>
                            <h4 class="text-md font-semibold text-gray-700 mb-3 flex items-center">
                              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
                              </svg>
                              Source Biochar
                            </h4>
                            <template x-if="grapheneRelatedData[record.experimentNumber].sourceBiochar">
                              <div class="bg-gray-50 border border-gray-200 rounded-lg p-3">
                                <table class="min-w-full text-xs">
                                  <tr><td class="font-medium">Experiment:</td><td x-text="grapheneRelatedData[record.experimentNumber].sourceBiochar.experimentNumber"></td></tr>
                                  <tr><td class="font-medium">Date:</td><td x-text="formatDate(grapheneRelatedData[record.experimentNumber].sourceBiochar.experimentDate)"></td></tr>
                                  <tr><td class="font-medium">Material:</td><td x-text="grapheneRelatedData[record.experimentNumber].sourceBiochar.rawMaterial"></td></tr>
                                  <tr><td class="font-medium">Reactor:</td><td x-text="grapheneRelatedData[record.experimentNumber].sourceBiochar.reactor"></td></tr>
                                  <tr><td class="font-medium">Output:</td><td x-text="grapheneRelatedData[record.experimentNumber].sourceBiochar.output ? grapheneRelatedData[record.experimentNumber].sourceBiochar.output + 'g' : ''"></td></tr>
                                </table>
                              </div>
                            </template>
                            
                            <template x-if="grapheneRelatedData[record.experimentNumber].lotBiocharExperiments && grapheneRelatedData[record.experimentNumber].lotBiocharExperiments.length > 0">
                              <div class="bg-link-light border border-link rounded-lg p-3">
                                <p class="font-medium text-sm mb-2">Lot Biochar Experiments:</p>
                                <div class="space-y-2">
                                  <template x-for="biochar in grapheneRelatedData[record.experimentNumber].lotBiocharExperiments">
                                    <div class="bg-white rounded p-2 text-xs border">
                                      <div class="flex justify-between">
                                        <span class="font-medium" x-text="biochar.experimentNumber"></span>
                                        <span x-text="formatDate(biochar.experimentDate)"></span>
                                      </div>
                                      <div class="text-gray-600">
                                        <span x-text="biochar.rawMaterial"></span> - 
                                        <span x-text="biochar.output ? biochar.output + 'g' : 'No output'"></span>
                                      </div>
                                    </div>
                                  </template>
                                </div>
                              </div>
                            </template>
                          </div>
                          
                          <!-- BET Test Results -->
                          <div>
                            <h4 class="text-md font-semibold text-gray-700 mb-3 flex items-center">
                              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                              </svg>
                              BET Test Results
                            </h4>
                            <template x-if="grapheneRelatedData[record.experimentNumber].betTests && grapheneRelatedData[record.experimentNumber].betTests.length > 0">
                              <div class="bg-gray-50 border border-gray-200 rounded-lg p-3">
                                <div class="space-y-2">
                                  <template x-for="bet in grapheneRelatedData[record.experimentNumber].betTests">
                                    <div class="bg-white rounded p-2 text-xs border">
                                      <div class="flex justify-between mb-1">
                                        <span class="font-medium">BET Test</span>
                                        <span x-text="formatDate(bet.testDate)"></span>
                                      </div>
                                      <table class="w-full">
                                        <tr><td class="font-medium">Multipoint BET:</td><td x-text="bet.multipointBetArea ? formatScientific(bet.multipointBetArea) + ' m²/g' : 'N/A'"></td></tr>
                                        <tr><td class="font-medium">Langmuir:</td><td x-text="bet.langmuirSurfaceArea ? formatScientific(bet.langmuirSurfaceArea) + ' m²/g' : 'N/A'"></td></tr>
                                        <tr><td class="font-medium">Species:</td><td x-text="bet.species || 'N/A'"></td></tr>
                                        <tr x-show="bet.researchTeam"><td class="font-medium">Research Team:</td><td x-text="bet.researchTeam || 'N/A'"></td></tr>
                                        <tr x-show="bet.testingLab"><td class="font-medium">Testing Lab:</td><td x-text="bet.testingLab || 'N/A'"></td></tr>
                                      </table>
                                      <template x-if="bet.comments">
                                        <p class="text-gray-600 mt-1" x-text="bet.comments"></p>
                                      </template>
                                      <template x-if="bet.betReportPath">
                                        <div class="mt-2 pt-2 border-t border-gray-200">
                                          <div class="flex items-center justify-between">
                                            <span class="text-xs font-medium text-gray-700">BET Report:</span>
                                            <button @click="window.open('/uploads/' + bet.betReportPath, '_blank')" 
                                                    class="text-link text-link-hover text-xs font-medium flex items-center">
                                              <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                              </svg>
                                              View PDF
                                            </button>
                                          </div>
                                        </div>
                                      </template>
                                    </div>
                                  </template>
                                </div>
                              </div>
                            </template>
                            
                            <template x-if="!grapheneRelatedData[record.experimentNumber].betTests || grapheneRelatedData[record.experimentNumber].betTests.length === 0">
                              <div class="bg-gray-100 border border-gray-200 rounded-lg p-3 text-center text-gray-500 text-sm">
                                No BET tests found for this graphene sample
                              </div>
                            </template>
                          </div>
                          
                          <!-- RAMAN Analysis Results -->
                          <div>
                            <h4 class="text-md font-semibold text-gray-700 mb-3 flex items-center">
                              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                              </svg>
                              RAMAN Analysis
                            </h4>
                            <template x-if="grapheneRelatedData[record.experimentNumber].ramanTests && grapheneRelatedData[record.experimentNumber].ramanTests.length > 0">
                              <div class="bg-gray-50 border border-gray-200 rounded-lg p-3">
                                <div class="space-y-2">
                                  <template x-for="raman in grapheneRelatedData[record.experimentNumber].ramanTests">
                                    <div class="bg-white rounded p-2 text-xs border">
                                      <div class="flex justify-between mb-1">
                                        <span class="font-medium">RAMAN Test</span>
                                        <span x-text="formatDate(raman.testDate)"></span>
                                      </div>
                                      <div class="mb-2">
                                        <div class="text-xs mb-1"><strong>Research Team:</strong> <span x-text="raman.researchTeam || 'N/A'"></span> | <strong>Testing Lab:</strong> <span x-text="raman.testingLab || 'N/A'"></span></div>
                                        <table class="w-full text-xs border border-gray-200">
                                          <thead class="bg-gray-50">
                                            <tr>
                                              <th class="px-1 py-1 text-left border-r border-gray-200 text-xs"></th>
                                              <th class="px-1 py-1 text-center border-r border-gray-200 text-xs">2D</th>
                                              <th class="px-1 py-1 text-center border-r border-gray-200 text-xs">G</th>
                                              <th class="px-1 py-1 text-center border-r border-gray-200 text-xs">D</th>
                                              <th class="px-1 py-1 text-center text-xs">D/G</th>
                                            </tr>
                                          </thead>
                                          <tbody>
                                            <tr class="border-t border-gray-200">
                                              <td class="px-1 py-1 font-medium border-r border-gray-200 text-xs">Int. Range</td>
                                              <td class="px-1 py-1 text-center border-r border-gray-200 font-mono text-xs" x-text="(raman.integrationRange2DLow && raman.integrationRange2DHigh) ? `${raman.integrationRange2DLow}-${raman.integrationRange2DHigh}` : '-'"></td>
                                              <td class="px-1 py-1 text-center border-r border-gray-200 font-mono text-xs" x-text="(raman.integrationRangeGLow && raman.integrationRangeGHigh) ? `${raman.integrationRangeGLow}-${raman.integrationRangeGHigh}` : '-'"></td>
                                              <td class="px-1 py-1 text-center border-r border-gray-200 font-mono text-xs" x-text="(raman.integrationRangeDLow && raman.integrationRangeDHigh) ? `${raman.integrationRangeDLow}-${raman.integrationRangeDHigh}` : '-'"></td>
                                              <td class="px-1 py-1 text-center font-mono text-xs" x-text="(raman.integrationRangeDGLow && raman.integrationRangeDGHigh) ? `${raman.integrationRangeDGLow}-${raman.integrationRangeDGHigh}` : '-'"></td>
                                            </tr>
                                            <tr class="border-t border-gray-200">
                                              <td class="px-1 py-1 font-medium border-r border-gray-200 text-xs">Integral A</td>
                                              <td class="px-1 py-1 text-center border-r border-gray-200 font-mono text-xs" x-text="(raman.integralTypA2D1 && raman.integralTypA2D2) ? `${raman.integralTypA2D1},${raman.integralTypA2D2}` : '-'"></td>
                                              <td class="px-1 py-1 text-center border-r border-gray-200 font-mono text-xs" x-text="(raman.integralTypAG1 && raman.integralTypAG2) ? `${raman.integralTypAG1},${raman.integralTypAG2}` : '-'"></td>
                                              <td class="px-1 py-1 text-center border-r border-gray-200 font-mono text-xs" x-text="(raman.integralTypAD1 && raman.integralTypAD2) ? `${raman.integralTypAD1},${raman.integralTypAD2}` : '-'"></td>
                                              <td class="px-1 py-1 text-center font-mono text-xs" x-text="(raman.integralTypADG1 && raman.integralTypADG2) ? `${raman.integralTypADG1},${raman.integralTypADG2}` : '-'"></td>
                                            </tr>
                                            <tr class="border-t border-gray-200">
                                              <td class="px-1 py-1 font-medium border-r border-gray-200 text-xs">Peak J</td>
                                              <td class="px-1 py-1 text-center border-r border-gray-200 font-mono text-xs" x-text="(raman.peakHighTypJ2D1 && raman.peakHighTypJ2D2) ? `${raman.peakHighTypJ2D1},${raman.peakHighTypJ2D2}` : '-'"></td>
                                              <td class="px-1 py-1 text-center border-r border-gray-200 font-mono text-xs" x-text="(raman.peakHighTypJG1 && raman.peakHighTypJG2) ? `${raman.peakHighTypJG1},${raman.peakHighTypJG2}` : '-'"></td>
                                              <td class="px-1 py-1 text-center border-r border-gray-200 font-mono text-xs" x-text="(raman.peakHighTypJD1 && raman.peakHighTypJD2) ? `${raman.peakHighTypJD1},${raman.peakHighTypJD2}` : '-'"></td>
                                              <td class="px-1 py-1 text-center font-mono text-xs" x-text="(raman.peakHighTypJDG1 && raman.peakHighTypJDG2) ? `${raman.peakHighTypJDG1},${raman.peakHighTypJDG2}` : '-'"></td>
                                            </tr>
                                          </tbody>
                                        </table>
                                      </div>
                                      <template x-if="raman.comments">
                                        <p class="text-gray-600 mt-1" x-text="raman.comments"></p>
                                      </template>
                                      <template x-if="raman.ramanReportPath">
                                        <div class="mt-2 pt-2 border-t border-gray-200">
                                          <div class="flex items-center justify-between">
                                            <span class="text-xs font-medium text-gray-700">RAMAN Report:</span>
                                            <button @click="viewRamanPdf(raman.ramanReportPath)" 
                                                    class="text-link text-link-hover text-xs font-medium flex items-center">
                                              <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                              </svg>
                                              View PDF
                                            </button>
                                          </div>
                                        </div>
                                      </template>
                                    </div>
                                  </template>
                                </div>
                              </div>
                            </template>
                            
                            <template x-if="!grapheneRelatedData[record.experimentNumber].ramanTests || grapheneRelatedData[record.experimentNumber].ramanTests.length === 0">
                              <div class="bg-gray-100 border border-gray-200 rounded-lg p-3 text-center text-gray-500 text-sm">
                                No RAMAN analysis found for this graphene sample
                              </div>
                            </template>
                          </div>
                          
                          <!-- Update Reports -->
                          <div>
                            <h4 class="text-md font-semibold text-gray-700 mb-3 flex items-center">
                              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                              </svg>
                              Update Reports
                            </h4>
                            <template x-if="record.updateReports && record.updateReports.length > 0">
                              <div class="bg-gray-50 border border-gray-200 rounded-lg p-3">
                                <div class="space-y-2">
                                  <template x-for="updateReport in record.updateReports">
                                    <div class="bg-white rounded p-2 text-xs border">
                                      <div class="flex justify-between mb-1">
                                        <button @click="viewUpdateReport(updateReport.updateReport.filePath)" 
                                                class="font-medium text-link text-link-hover text-left">
                                          <span x-text="updateReport.updateReport.originalName"></span>
                                        </button>
                                        <span class="text-gray-500" x-text="updateReport.updateReport.weekOf ? 'Week of ' + new Date(updateReport.updateReport.weekOf).toLocaleDateString() : 'No date'"></span>
                                      </div>
                                      <div x-show="updateReport.updateReport.description" class="text-gray-600">
                                        <span x-text="updateReport.updateReport.description"></span>
                                      </div>
                                      <div class="text-gray-400 text-xs mt-1">
                                        Uploaded: <span x-text="formatDate(updateReport.updateReport.createdAt)"></span>
                                      </div>
                                    </div>
                                  </template>
                                </div>
                              </div>
                            </template>
                            
                            <template x-if="!record.updateReports || record.updateReports.length === 0">
                              <div class="bg-gray-100 border border-gray-200 rounded-lg p-3 text-center text-gray-500 text-sm">
                                No update reports associated with this experiment
                              </div>
                            </template>
                          </div>
                          
                          <!-- SEM Reports -->
                          <div>
                            <h4 class="text-md font-semibold text-gray-700 mb-3 flex items-center">
                              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                              </svg>
                              SEM Reports
                            </h4>
                            
                            <!-- Direct attachment -->
                            <template x-if="record.semReportPath">
                              <div class="bg-gray-50 border border-gray-200 rounded-lg p-3 mb-2">
                                <div class="bg-white rounded p-2 text-xs border">
                                  <div class="flex justify-between items-center">
                                    <button @click="viewSemReport(record.semReportPath)" 
                                            class="font-medium text-link text-link-hover text-left">
                                      <span x-text="record.semReportPath.split('/').pop().replace(/_\d+\.pdf$/, '.pdf')"></span>
                                    </button>
                                    <span class="text-gray-500 text-xs">Uploaded with record</span>
                                  </div>
                                </div>
                              </div>
                            </template>
                            
                            <!-- Associated SEM reports -->
                            <template x-if="record.semReports && record.semReports.length > 0">
                              <div class="space-y-2">
                                <template x-for="semReport in record.semReports">
                                  <div class="bg-gray-50 border border-gray-200 rounded-lg p-3">
                                    <div class="bg-white rounded p-2 text-xs border">
                                      <div class="flex justify-between items-center">
                                        <div>
                                          <button @click="viewSemPdf('/uploads/' + semReport.semReport.filePath)" 
                                                  class="font-medium text-link text-link-hover text-left">
                                            <span x-text="semReport.semReport.originalName"></span>
                                          </button>
                                          <div x-show="semReport.semReport.description" class="text-gray-500 text-xs mt-1" x-text="semReport.semReport.description"></div>
                                        </div>
                                        <span class="text-gray-500 text-xs">Associated report</span>
                                      </div>
                                    </div>
                                  </div>
                                </template>
                              </div>
                            </template>
                            
                            <template x-if="!record.semReportPath && (!record.semReports || record.semReports.length === 0)">
                              <div class="bg-gray-100 border border-gray-200 rounded-lg p-3 text-center text-gray-500 text-sm">
                                No SEM reports available for this experiment
                              </div>
                            </template>
                          </div>
                          
                          <!-- Experiment Objective & Results -->
                          <div x-show="record.objective || record.experimentDetails || record.result || record.conclusion || record.recommendedAction">
                            <h4 class="text-md font-semibold text-gray-700 mb-3 flex items-center">
                              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                              </svg>
                              Experiment Objective & Results
                            </h4>
                            <div class="bg-link-light border border-link rounded-lg p-3 space-y-3">
                              <div x-show="record.objective">
                                <h5 class="font-semibold text-sm text-gray-700">Objective:</h5>
                                <p class="text-sm text-gray-600 whitespace-pre-wrap" x-text="record.objective"></p>
                              </div>
                              <div x-show="record.experimentDetails">
                                <h5 class="font-semibold text-sm text-gray-700">Experiment Details:</h5>
                                <p class="text-sm text-gray-600 whitespace-pre-wrap" x-text="record.experimentDetails"></p>
                              </div>
                              <div x-show="record.result">
                                <h5 class="font-semibold text-sm text-gray-700">Result:</h5>
                                <p class="text-sm text-gray-600 whitespace-pre-wrap" x-text="record.result"></p>
                              </div>
                              <div x-show="record.conclusion">
                                <h5 class="font-semibold text-sm text-gray-700">Conclusion:</h5>
                                <p class="text-sm text-gray-600 whitespace-pre-wrap" x-text="record.conclusion"></p>
                              </div>
                              <div x-show="record.recommendedAction">
                                <h5 class="font-semibold text-sm text-gray-700">Recommended Action:</h5>
                                <p class="text-sm text-gray-600 whitespace-pre-wrap" x-text="record.recommendedAction"></p>
                              </div>
                            </div>
                          </div>
                        </div>
                      </template>
                    </div>
                  </td>
                </tr>
              </tbody>
            </template>
          </table>
        </div>
      </div>


      <!-- BET Tab -->
      <div x-show="activeTab === 'test-bet'" x-cloak>
        <div class="mb-6 flex justify-between items-center">
          <h2 class="text-xl font-semibold">BET Surface Area Analysis</h2>
          <div class="flex space-x-2">
            <button @click="exportData('test-bet')" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">
              Export CSV
            </button>
            <button @click="betForm = {testDate: '', dateUnknown: false, grapheneSample: '', multipointBetArea: '', langmuirSurfaceArea: '', species: '', comments: ''}; editingBet = null; showAddBet = true" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">
              Add Record
            </button>
          </div>
        </div>

        <!-- Search Bar -->
        <div class="mb-4">
          <input
            type="text"
            x-model="betSearch"
            @input="searchBet()"
            placeholder="Search samples, graphene batches..."
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black"
          >
        </div>

        <!-- BET Table -->
        <div class="overflow-x-auto border border-gray-200 rounded-lg">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Graphene Sample</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Research Team</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Testing Lab</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Multipoint BET Area (m²/g)</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Langmuir Surface Area (m²/g)</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Species</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">BET Report</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <template x-for="record in betRecords" :key="record.id">
                <tr class="hover:bg-gray-50">
                  <td class="px-4 py-3 text-sm" x-text="formatDate(record.testDate)"></td>
                  <td class="px-4 py-3 text-sm font-mono" x-text="record.grapheneSample"></td>
                  <td class="px-4 py-3 text-sm" x-text="record.researchTeam"></td>
                  <td class="px-4 py-3 text-sm" x-text="record.testingLab"></td>
                  <td class="px-4 py-3 text-sm font-mono" x-text="formatScientificNotation(record.multipointBetArea)"></td>
                  <td class="px-4 py-3 text-sm font-mono" x-text="formatScientificNotation(record.langmuirSurfaceArea)"></td>
                  <td class="px-4 py-3 text-sm" x-text="record.species"></td>
                  <td class="px-4 py-3 text-sm">
                    <template x-if="record.betReportPath">
                      <button @click="window.open('/uploads/' + record.betReportPath, '_blank')" 
                              class="text-link text-link-hover text-sm font-medium">
                        View PDF
                      </button>
                    </template>
                    <template x-if="!record.betReportPath">
                      <span class="text-gray-400 text-sm">No report</span>
                    </template>
                  </td>
                  <td class="px-4 py-3 text-sm">
                    <div class="flex items-center space-x-2">
                      <template x-if="record.comments">
                        <div class="relative group">
                          <svg class="w-4 h-4 text-gray-400 hover:text-gray-600 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path>
                          </svg>
                          <div class="absolute bottom-full left-0 mb-1 hidden group-hover:block z-10 w-64 p-2 bg-gray-900 text-white text-xs rounded shadow-lg">
                            <span x-text="record.comments"></span>
                          </div>
                        </div>
                      </template>
                      <button @click="editBet(record)" class="text-gray-600 hover:text-gray-900">Edit</button>
                      <button @click="deleteBet(record.id)" class="text-red-600 hover:text-red-900">Delete</button>
                    </div>
                  </td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Conductivity Tests Tab -->
      <div x-show="activeTab === 'test-conductivity'" x-cloak>
        <div class="mb-6 flex justify-between items-center">
          <h2 class="text-xl font-semibold">Conductivity Test Results</h2>
          <div class="flex space-x-2">
            <button @click="exportData('test-conductivity')" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">
              Export CSV
            </button>
            <button @click="conductivityForm = {testDate: '', dateUnknown: false, grapheneSample: '', description: '', conductivity1kN: '', conductivity8kN: '', conductivity12kN: '', conductivity20kN: '', comments: ''}; editingConductivity = null; showAddConductivity = true" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">
              Add Record
            </button>
          </div>
        </div>

        <!-- Search Bar -->
        <div class="mb-4">
          <input
            type="text"
            x-model="conductivitySearch"
            @input="searchConductivity()"
            placeholder="Search samples, descriptions..."
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black"
          >
        </div>

        <!-- Conductivity Table -->
        <div class="overflow-x-auto border border-gray-200 rounded-lg">
          <table class="min-w-full divide-y divide-gray-200">
            <thead>
              <tr class="bg-gray-100">
                <th class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Test Date</th>
                <th class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Graphene Sample</th>
                <th class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Description</th>
                <th class="px-2 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">1kN (S/cm²)</th>
                <th class="px-2 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">8kN (S/cm²)</th>
                <th class="px-2 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">12kN (S/cm²)</th>
                <th class="px-2 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">20kN (S/cm²)</th>
                <th class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Actions</th>
              </tr>
            </thead>
              <template x-for="record in conductivityRecords" :key="record.id">
                <tbody class="bg-white divide-y divide-gray-200">
                  <tr class="hover:bg-gray-50">
                    <td class="px-2 py-2 text-xs border-r border-gray-200" x-text="record.testDate ? new Date(record.testDate).toLocaleDateString() : ''"></td>
                    <td class="px-2 py-2 text-xs font-mono border-r border-gray-200">
                      <button @click="toggleExpanded('conductivity', record.id)" class="text-link text-link-hover font-medium">
                        <span x-text="record.grapheneSample"></span>
                        <svg class="w-4 h-4 inline ml-1" :class="{'transform rotate-180': expandedRows['conductivity_' + record.id]}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                      </button>
                    </td>
                    <td class="px-2 py-2 text-xs border-r border-gray-200" x-text="record.description"></td>
                    <td class="px-2 py-2 text-xs font-mono text-center border-r border-gray-200" x-text="record.conductivity1kN || ''"></td>
                    <td class="px-2 py-2 text-xs font-mono text-center border-r border-gray-200" x-text="record.conductivity8kN || ''"></td>
                    <td class="px-2 py-2 text-xs font-mono text-center border-r border-gray-200" x-text="record.conductivity12kN || ''"></td>
                    <td class="px-2 py-2 text-xs font-mono text-center border-r border-gray-200" x-text="record.conductivity20kN || ''"></td>
                    <td class="px-2 py-2 text-xs">
                      <div class="flex space-x-2">
                        <button @click="editConductivity(record)" class="text-link text-link-hover">Edit</button>
                        <button @click="deleteConductivity(record.id)" class="text-red-600 hover:text-red-900">Delete</button>
                      </div>
                    </td>
                  </tr>
                  <tr x-show="expandedRows['conductivity_' + record.id]" class="bg-gray-50">
                    <td colspan="8" class="px-2 py-2 text-xs">
                      <div class="grid grid-cols-1 gap-2">
                        <div class="text-xs"><strong>Comments:</strong> <span x-text="record.comments || 'None'"></span></div>
                        <div class="text-xs text-gray-500">Created: <span x-text="new Date(record.createdAt).toLocaleString()"></span></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </template>
          </table>
        </div>
      </div>

      <!-- RAMAN Analysis Tab -->
      <div x-show="activeTab === 'test-raman'" x-cloak>
        <div class="mb-6 flex justify-between items-center">
          <h2 class="text-xl font-semibold">RAMAN Analysis Results</h2>
          <div class="flex space-x-2">
            <button @click="exportData('test-raman')" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">
              Export CSV
            </button>
            <button @click="ramanForm = {testDate: '', dateUnknown: false, grapheneSample: '', researchTeam: 'Curia - Germany', testingLab: '', integrationRange2DLow: '', integrationRange2DHigh: '', integrationRangeGLow: '', integrationRangeGHigh: '', integrationRangeDLow: '', integrationRangeDHigh: '', integrationRangeDGLow: '', integrationRangeDGHigh: '', integralTypA2D1: '', integralTypA2D2: '', integralTypAG1: '', integralTypAG2: '', integralTypAD1: '', integralTypAD2: '', integralTypADG1: '', integralTypADG2: '', peakHighTypJ2D1: '', peakHighTypJ2D2: '', peakHighTypJG1: '', peakHighTypJG2: '', peakHighTypJD1: '', peakHighTypJD2: '', peakHighTypJDG1: '', peakHighTypJDG2: '', ramanReportFile: null, comments: ''}; editingRaman = null; showAddRaman = true" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">
              Add Record
            </button>
          </div>
        </div>

        <!-- Search Bar -->
        <div class="mb-4">
          <input
            type="text"
            x-model="ramanSearch"
            @input="searchRaman()"
            placeholder="Search samples, labs, teams..."
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black"
          >
        </div>

        <!-- RAMAN Table -->
        <div class="overflow-x-auto border border-gray-200 rounded-lg">
          <table class="min-w-full divide-y divide-gray-200">
            <thead>
              <tr class="bg-gray-100">
                <th class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Test Date</th>
                <th class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Graphene Sample</th>
                <th class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Testing Lab</th>
                <th class="px-2 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300" colspan="4">Integral Typ A</th>
                <th class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Actions</th>
              </tr>
              <tr class="bg-gray-100">
                <th class="px-2 py-1 border-r border-gray-300"></th>
                <th class="px-2 py-1 border-r border-gray-300"></th>
                <th class="px-2 py-1 border-r border-gray-300"></th>
                <th class="px-2 py-1 text-center text-xs font-semibold text-gray-600 border-r border-gray-200">2D Band</th>
                <th class="px-2 py-1 text-center text-xs font-semibold text-gray-600 border-r border-gray-200">G Band</th>
                <th class="px-2 py-1 text-center text-xs font-semibold text-gray-600 border-r border-gray-200">D Band</th>
                <th class="px-2 py-1 text-center text-xs font-semibold text-gray-600 border-r border-gray-300">D/G Ratio</th>
                <th class="px-2 py-1"></th>
              </tr>
            </thead>
              <template x-for="record in ramanRecords" :key="record.id">
                <tbody class="bg-white divide-y divide-gray-200">
                  <tr class="hover:bg-gray-50">
                    <td class="px-2 py-2 text-xs border-r border-gray-200" x-text="record.testDate ? new Date(record.testDate).toLocaleDateString() : ''"></td>
                    <td class="px-2 py-2 text-xs font-mono border-r border-gray-200">
                      <button @click="toggleExpanded('raman', record.id)" class="text-link text-link-hover font-medium">
                        <span x-text="record.grapheneSample"></span>
                        <svg class="w-4 h-4 inline ml-1" :class="{'transform rotate-180': expandedRows['raman_' + record.id]}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                      </button>
                    </td>
                    <td class="px-2 py-2 text-xs border-r border-gray-200" x-text="record.testingLab"></td>
                    <td class="px-2 py-2 text-xs font-mono text-center border-r border-gray-200" x-text="(record.integralTypA2D1 && record.integralTypA2D2) ? `${record.integralTypA2D1},${record.integralTypA2D2}` : ''"></td>
                    <td class="px-2 py-2 text-xs font-mono text-center border-r border-gray-200" x-text="(record.integralTypAG1 && record.integralTypAG2) ? `${record.integralTypAG1},${record.integralTypAG2}` : ''"></td>
                    <td class="px-2 py-2 text-xs font-mono text-center border-r border-gray-200" x-text="(record.integralTypAD1 && record.integralTypAD2) ? `${record.integralTypAD1},${record.integralTypAD2}` : ''"></td>
                    <td class="px-2 py-2 text-xs font-mono text-center border-r border-gray-200" x-text="(record.integralTypADG1 && record.integralTypADG2) ? `${record.integralTypADG1},${record.integralTypADG2}` : ''"></td>
                    <td class="px-2 py-2 text-xs">
                      <div class="flex space-x-2">
                        <button @click="editRaman(record)" class="text-link text-link-hover">Edit</button>
                        <button @click="deleteRaman(record.id)" class="text-red-600 hover:text-red-900">Delete</button>
                      </div>
                    </td>
                  </tr>
                  <tr x-show="expandedRows['raman_' + record.id]" class="bg-gray-50">
                    <td colspan="8" class="px-2 py-2 text-xs">
                      <div class="space-y-3">
                        <!-- RAMAN Data Matrix -->
                        <div>
                          <h5 class="font-semibold mb-2">Absorption Band Analysis</h5>
                          <table class="w-full text-xs border border-gray-200">
                            <thead class="bg-gray-100">
                              <tr>
                                <th class="px-2 py-1 text-left border-r border-gray-200"></th>
                                <th class="px-2 py-1 text-center border-r border-gray-200">2D Band</th>
                                <th class="px-2 py-1 text-center border-r border-gray-200">G Band</th>
                                <th class="px-2 py-1 text-center border-r border-gray-200">D Band</th>
                                <th class="px-2 py-1 text-center">D/G Ratio</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr class="border-t border-gray-200">
                                <td class="px-2 py-1 font-medium border-r border-gray-200">Integration Range</td>
                                <td class="px-2 py-1 text-center font-mono border-r border-gray-200" x-text="(record.integrationRange2DLow && record.integrationRange2DHigh) ? `${record.integrationRange2DLow}-${record.integrationRange2DHigh}` : '-'"></td>
                                <td class="px-2 py-1 text-center font-mono border-r border-gray-200" x-text="(record.integrationRangeGLow && record.integrationRangeGHigh) ? `${record.integrationRangeGLow}-${record.integrationRangeGHigh}` : '-'"></td>
                                <td class="px-2 py-1 text-center font-mono border-r border-gray-200" x-text="(record.integrationRangeDLow && record.integrationRangeDHigh) ? `${record.integrationRangeDLow}-${record.integrationRangeDHigh}` : '-'"></td>
                                <td class="px-2 py-1 text-center font-mono" x-text="(record.integrationRangeDGLow && record.integrationRangeDGHigh) ? `${record.integrationRangeDGLow}-${record.integrationRangeDGHigh}` : '-'"></td>
                              </tr>
                              <tr class="border-t border-gray-200">
                                <td class="px-2 py-1 font-medium border-r border-gray-200">Integral Typ A</td>
                                <td class="px-2 py-1 text-center font-mono border-r border-gray-200" x-text="(record.integralTypA2D1 && record.integralTypA2D2) ? `${record.integralTypA2D1},${record.integralTypA2D2}` : '-'"></td>
                                <td class="px-2 py-1 text-center font-mono border-r border-gray-200" x-text="(record.integralTypAG1 && record.integralTypAG2) ? `${record.integralTypAG1},${record.integralTypAG2}` : '-'"></td>
                                <td class="px-2 py-1 text-center font-mono border-r border-gray-200" x-text="(record.integralTypAD1 && record.integralTypAD2) ? `${record.integralTypAD1},${record.integralTypAD2}` : '-'"></td>
                                <td class="px-2 py-1 text-center font-mono" x-text="(record.integralTypADG1 && record.integralTypADG2) ? `${record.integralTypADG1},${record.integralTypADG2}` : '-'"></td>
                              </tr>
                              <tr class="border-t border-gray-200">
                                <td class="px-2 py-1 font-medium border-r border-gray-200">Peak High Typ J</td>
                                <td class="px-2 py-1 text-center font-mono border-r border-gray-200" x-text="(record.peakHighTypJ2D1 && record.peakHighTypJ2D2) ? `${record.peakHighTypJ2D1},${record.peakHighTypJ2D2}` : '-'"></td>
                                <td class="px-2 py-1 text-center font-mono border-r border-gray-200" x-text="(record.peakHighTypJG1 && record.peakHighTypJG2) ? `${record.peakHighTypJG1},${record.peakHighTypJG2}` : '-'"></td>
                                <td class="px-2 py-1 text-center font-mono border-r border-gray-200" x-text="(record.peakHighTypJD1 && record.peakHighTypJD2) ? `${record.peakHighTypJD1},${record.peakHighTypJD2}` : '-'"></td>
                                <td class="px-2 py-1 text-center font-mono" x-text="(record.peakHighTypJDG1 && record.peakHighTypJDG2) ? `${record.peakHighTypJDG1},${record.peakHighTypJDG2}` : '-'"></td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                        
                        <!-- Additional Info -->
                        <div class="grid grid-cols-2 gap-4">
                          <div>
                            <div class="mb-2"><strong>Research Team:</strong> <span x-text="record.researchTeam || 'N/A'"></span></div>
                            <template x-if="record.ramanReportPath">
                              <div class="mb-2">
                                <strong>RAMAN Report:</strong>
                                <button @click="viewRamanPdf(record.ramanReportPath)" class="text-link text-link-hover ml-1">
                                  View PDF
                                </button>
                              </div>
                            </template>
                          </div>
                          <div>
                            <div class="mb-2"><strong>Comments:</strong> <span x-text="record.comments || 'None'"></span></div>
                            <div class="text-xs text-gray-500">Created: <span x-text="new Date(record.createdAt).toLocaleString()"></span></div>
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </template>
          </table>
        </div>
      </div>

      <!-- SEM Reports Tab -->
      <div x-show="activeTab === 'test-sem'" x-cloak>
        <div class="mb-6 flex justify-between items-center">
          <h2 class="text-xl font-semibold">SEM Report Management</h2>
          <div class="flex space-x-2">
            <button @click="semReportForm = {description: '', uploadDate: '', grapheneIds: [], semFiles: null}; editingSemReport = null; showAddSemReport = true" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">
              Upload Reports
            </button>
          </div>
        </div>

        <!-- Search Bar -->
        <div class="mb-4">
          <input
            type="text"
            x-model="semReportSearch"
            @input="searchSemReports()"
            placeholder="Search filenames, descriptions, experiments..."
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black"
          >
        </div>

        <!-- SEM Reports Table -->
        <div class="overflow-x-auto border border-gray-200 rounded-lg">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-100">
              <tr>
                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Sample #</th>
                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Date</th>
                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Species</th>
                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">PDF Name</th>
                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Actions</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <template x-if="semReports.length === 0">
                <tr>
                  <td colspan="5" class="px-4 py-8 text-center text-gray-500">
                    No SEM reports found
                  </td>
                </tr>
              </template>
              <template x-for="report in semReports" :key="report.id">
                <tr class="hover:bg-gray-50">
                  <!-- Sample # Column -->
                  <td class="px-4 py-3 text-sm">
                    <template x-if="report.grapheneReports && report.grapheneReports.length > 0">
                      <div class="space-y-1">
                        <template x-for="gr in report.grapheneReports">
                          <div class="text-sm font-medium" x-text="gr.graphene.experimentNumber"></div>
                        </template>
                      </div>
                    </template>
                    <template x-if="!report.grapheneReports || report.grapheneReports.length === 0">
                      <span class="text-gray-400 text-sm">-</span>
                    </template>
                  </td>
                  
                  <!-- Date Column -->
                  <td class="px-4 py-3 text-sm text-gray-500" x-text="formatDate(report.reportDate)"></td>
                  
                  <!-- Species Column -->
                  <td class="px-4 py-3 text-sm">
                    <template x-if="report.grapheneReports && report.grapheneReports.length > 0">
                      <div class="space-y-1">
                        <template x-for="gr in report.grapheneReports">
                          <div class="text-sm" x-text="gr.graphene.species || '-'"></div>
                        </template>
                      </div>
                    </template>
                    <template x-if="!report.grapheneReports || report.grapheneReports.length === 0">
                      <span class="text-gray-400 text-sm">-</span>
                    </template>
                  </td>
                  
                  <!-- PDF Name Column -->
                  <td class="px-4 py-3">
                    <div class="flex items-center">
                      <svg class="w-4 h-4 mr-2 text-red-500" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"></path>
                      </svg>
                      <span class="text-sm font-medium" x-text="report.originalName"></span>
                    </div>
                  </td>
                  <td class="px-4 py-3 text-sm space-x-2">
                    <button @click="viewSemPdf('/uploads/' + report.filePath)" class="text-link text-link-hover">
                      View PDF
                    </button>
                    <button @click="editSemReport(report)" class="text-gray-600 hover:text-gray-800">
                      Edit
                    </button>
                    <button @click="deleteSemReport(report.id)" class="text-red-600 hover:text-red-800">
                      Delete
                    </button>
                  </td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Update Reports Tab -->
      <div x-show="activeTab === 'updates'" x-cloak>
        <div class="mb-6 flex justify-between items-center">
          <h2 class="text-xl font-semibold">Weekly Update Reports</h2>
          <div class="flex space-x-2">
            <button @click="updateReportForm = {description: '', weekOf: '', grapheneIds: [], updateFile: null}; editingUpdateReport = null; showAddUpdateReport = true" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">
              Upload Report
            </button>
          </div>
        </div>

        <!-- Search Bar -->
        <div class="mb-4">
          <input
            type="text"
            x-model="updateReportSearch"
            @input="searchUpdateReports()"
            placeholder="Search reports, descriptions..."
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black"
          >
        </div>

        <!-- Update Reports Table -->
        <div class="overflow-x-auto border border-gray-200 rounded-lg">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-100">
              <tr>
                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">File Name</th>
                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Week Of</th>
                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Description</th>
                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Associated Experiments</th>
                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Uploaded</th>
                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Actions</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <template x-for="report in updateReports" :key="report.id">
                <tr class="hover:bg-gray-50">
                  <td class="px-4 py-3 text-sm">
                    <button @click="viewUpdateReport(report.filePath)" 
                            class="text-link text-link-hover font-medium">
                      <span x-text="report.originalName"></span>
                    </button>
                  </td>
                  <td class="px-4 py-3 text-sm" x-text="report.weekOf ? new Date(report.weekOf).toLocaleDateString() : '-'"></td>
                  <td class="px-4 py-3 text-sm">
                    <div class="max-w-xs truncate" x-text="report.description || '-'"></div>
                  </td>
                  <td class="px-4 py-3 text-sm">
                    <div class="max-w-xs">
                      <template x-if="report.grapheneReports && report.grapheneReports.length > 0">
                        <div>
                          <template x-for="(gr, index) in report.grapheneReports.slice(0, 3)" :key="gr.id">
                            <span>
                              <span x-text="gr.graphene.experimentNumber"></span><span x-show="index < Math.min(2, report.grapheneReports.length - 1)">, </span>
                            </span>
                          </template>
                          <span x-show="report.grapheneReports.length > 3" x-text="`... +${report.grapheneReports.length - 3} more`"></span>
                        </div>
                      </template>
                      <template x-if="!report.grapheneReports || report.grapheneReports.length === 0">
                        <span class="text-gray-500">No associations</span>
                      </template>
                    </div>
                  </td>
                  <td class="px-4 py-3 text-sm text-gray-500" x-text="formatDate(report.createdAt)"></td>
                  <td class="px-4 py-3 text-sm">
                    <div class="flex space-x-2">
                      <button @click="editUpdateReport(report)" 
                              class="text-link text-link-hover text-sm">Edit</button>
                      <button @click="deleteUpdateReport(report.id)" 
                              class="text-red-600 hover:text-red-800 text-sm">Delete</button>
                    </div>
                  </td>
                </tr>
              </template>
              <template x-if="updateReports.length === 0">
                <tr>
                  <td colspan="6" class="px-4 py-8 text-center text-gray-500">
                    No update reports found. Upload your first weekly report to get started.
                  </td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </div>
    </main>

    <!-- Biochar Add/Edit Modal -->
    <div x-show="showAddBiochar" x-cloak
         @click.away="showAddBiochar = false; editingBiochar = null"
         class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto p-6">
          <h3 class="text-lg font-semibold mb-4" x-text="editingBiochar ? 'Edit Biochar Record' : 'Add Biochar Record'"></h3>
          
          <form @submit.prevent="saveBiochar()" class="space-y-6">
            <!-- Basic Information -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Basic Information</h4>
              <div class="grid grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Experiment #</label>
                  <input type="text" x-model="biocharForm.experimentNumber" required
                         class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Test Order</label>
                  <input type="number" x-model="biocharForm.testOrder" 
                         placeholder="1, 2, 3..."
                         class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
                </div>
                <div x-html="getDateFieldHtml({
                  label: 'Experiment Date', 
                  dateModelVariable: 'biocharForm.experimentDate',
                  unknownModelVariable: 'biocharForm.dateUnknown'
                })"></div>
                <div x-html="getSelectFieldHtml({
                  label: 'Research Team',
                  modelVariable: 'biocharForm.researchTeam',
                  optionsArray: 'researchTeams',
                  showModalVariable: 'showAddResearchTeam',
                  placeholder: 'Select team...',
                  addNewText: 'Team',
                  resetValue: 'Curia - Germany'
                })"></div>
              </div>
            </div>

            <!-- Setup & Materials -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Setup & Materials</h4>
              <div class="grid grid-cols-3 gap-4">
                <div x-html="getSelectFieldHtml({
                  label: 'Reactor',
                  modelVariable: 'biocharForm.reactor',
                  optionsArray: 'reactors',
                  showModalVariable: 'showAddReactor',
                  placeholder: 'Select reactor...',
                  addNewText: 'Reactor',
                  resetValue: ''
                })"></div>
                <div x-html="getSelectFieldHtml({
                  label: 'Raw Material',
                  modelVariable: 'biocharForm.rawMaterial',
                  optionsArray: 'rawMaterials',
                  showModalVariable: 'showAddMaterial',
                  placeholder: 'Select material...',
                  addNewText: 'Material',
                  resetValue: ''
                })"></div>
                <div x-html="getNumericFieldHtml({
                  label: 'Starting Amount',
                  unit: 'g',
                  modelVariable: 'biocharForm.startingAmount',
                  step: '0.01'
                })"></div>
              </div>
            </div>
            
            <!-- Acid Treatment -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Acid Treatment</h4>
              <div class="grid grid-cols-4 gap-4">
                <div x-html="getNumericFieldHtml({
                  label: 'Amount',
                  unit: 'g',
                  modelVariable: 'biocharForm.acidAmount',
                  step: '0.01'
                })"></div>
                <div x-html="getNumericFieldHtml({
                  label: 'Concentration',
                  unit: '%',
                  modelVariable: 'biocharForm.acidConcentration',
                  step: '0.01'
                })"></div>
                <div x-html="getNumericFieldHtml({
                  label: 'Molarity',
                  unit: 'M',
                  modelVariable: 'biocharForm.acidMolarity',
                  step: '0.01'
                })"></div>
                <div x-html="getSelectFieldHtml({
                  label: 'Type',
                  modelVariable: 'biocharForm.acidType',
                  optionsArray: 'acidTypes',
                  showModalVariable: 'showAddAcidType',
                  placeholder: 'Select...',
                  addNewText: 'Acid Type',
                  resetValue: ''
                })"></div>
              </div>
            </div>
            
            <!-- Process Conditions -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Process Conditions</h4>
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div x-html="getNumericFieldHtml({
                  label: 'Temperature',
                  unit: '°C',
                  modelVariable: 'biocharForm.temperature',
                  step: '0.1'
                })"></div>
                <div x-html="getNumericFieldHtml({
                  label: 'Time',
                  unit: 'hr',
                  modelVariable: 'biocharForm.time',
                  step: '0.1'
                })"></div>
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div x-html="getNumericFieldHtml({
                  label: 'Initial Pressure',
                  unit: 'bar',
                  modelVariable: 'biocharForm.pressureInitial',
                  step: '0.1'
                })"></div>
                <div x-html="getNumericFieldHtml({
                  label: 'Final Pressure',
                  unit: 'bar',
                  modelVariable: 'biocharForm.pressureFinal',
                  step: '0.1'
                })"></div>
              </div>
            </div>
            
            <!-- Post-Processing -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Post-Processing</h4>
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div x-html="getNumericFieldHtml({
                  label: 'Wash Amount',
                  unit: 'g',
                  modelVariable: 'biocharForm.washAmount',
                  step: '0.01'
                })"></div>
                <div x-html="getSelectFieldHtml({
                  label: 'Wash Medium',
                  modelVariable: 'biocharForm.washMedium',
                  optionsArray: 'washMediums',
                  showModalVariable: 'showAddWashMedium',
                  placeholder: 'Select medium...',
                  addNewText: 'Medium',
                  resetValue: ''
                })"></div>
              </div>
              <div class="grid grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Drying Temp (°C)</label>
                  <input type="number" step="0.1" x-model="biocharForm.dryingTemp"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">KFT (%)</label>
                  <input type="number" step="0.01" x-model="biocharForm.kftPercentage"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Output (g)</label>
                  <input type="number" step="0.01" x-model="biocharForm.output"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
              </div>
            </div>
            
            <!-- Comments -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Comments</label>
              <textarea x-model="biocharForm.comments" rows="2"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md"></textarea>
            </div>
            
            <div class="flex justify-end space-x-2 pt-4">
              <button type="button" @click="showAddBiochar = false; editingBiochar = null; biocharForm = {}"
                      class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">
                Cancel
              </button>
              <button type="submit"
                      class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">
                Save
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Graphene Add/Edit Modal -->
    <div x-show="showAddGraphene" x-cloak
         @click.away="showAddGraphene = false; editingGraphene = null"
         class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto p-6">
          <h3 class="text-lg font-semibold mb-4" x-text="editingGraphene ? 'Edit Graphene Record' : 'Add Graphene Record'"></h3>
          
          <form @submit.prevent="saveGraphene()" class="space-y-6">
            <!-- Basic Information -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Basic Information</h4>
              <div class="grid grid-cols-4 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Experiment #</label>
                  <input type="text" x-model="grapheneForm.experimentNumber" required
                         class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Title Note</label>
                  <div class="relative">
                    <select x-model="grapheneForm.titleNote"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black appearance-none">
                      <option value="">None</option>
                      <template x-for="note in titleNotes" :key="note">
                        <option :value="note" x-text="note"></option>
                      </template>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Test Order</label>
                  <input type="number" x-model="grapheneForm.testOrder" 
                         placeholder="1, 2, 3..."
                         class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
                </div>
                <div x-html="getDateFieldHtml({
                  label: 'Experiment Date', 
                  dateModelVariable: 'grapheneForm.experimentDate',
                  unknownModelVariable: 'grapheneForm.dateUnknown'
                })"></div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Research Team</label>
                  <div class="relative">
                    <select x-model="grapheneForm.researchTeam" 
                            @change="if($event.target.value === 'add_new') { showAddResearchTeam = true; grapheneForm.researchTeam = 'Curia - Germany'; }"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black appearance-none">
                      <option value="">Select team...</option>
                      <template x-for="team in researchTeams" :key="team">
                        <option :value="team" x-text="team"></option>
                      </template>
                      <option value="add_new" class="font-semibold">+ Add New Team</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Setup & Materials -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Setup & Materials</h4>
              <div class="grid grid-cols-3 gap-4">
                <div x-html="getSelectFieldHtml({
                  label: 'Oven',
                  modelVariable: 'grapheneForm.oven',
                  optionsArray: 'ovens',
                  showModalVariable: 'showAddOven',
                  placeholder: 'Select oven...',
                  addNewText: 'Oven',
                  resetValue: ''
                })"></div>
                <div x-html="getNumericFieldHtml({
                  label: 'Quantity',
                  unit: 'g',
                  modelVariable: 'grapheneForm.quantity',
                  step: '0.01'
                })"></div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Biochar Source</label>
                  <div class="relative">
                    <select x-model="grapheneForm.biocharSource" 
                            @change="handleBiocharSourceChange($event)"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black appearance-none">
                      <option value="">Select biochar source...</option>
                      <option value="various">Various (Mixed Sources)</option>
                      <optgroup label="Individual Experiments">
                        <template x-for="exp in availableExperiments" :key="'exp-' + exp">
                          <option :value="'exp:' + exp" x-text="'EXP: ' + exp"></option>
                        </template>
                      </optgroup>
                      <optgroup label="Combined Lots" x-show="availableLots.length > 0">
                        <template x-for="lot in availableLots" :key="'lot-' + lot.lotNumber">
                          <option :value="'lot:' + lot.lotNumber" x-text="'LOT: ' + lot.lotNumber + (lot.lotName ? ' (' + lot.lotName + ')' : '') + ' - ' + lot._count.experiments + ' experiments'"></option>
                        </template>
                      </optgroup>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </div>
                  <p class="text-xs text-gray-500 mt-1">Select individual experiment or combined lot</p>
                </div>
              </div>
              
              <!-- Comments row -->
              <div class="grid grid-cols-1 gap-4 mt-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Comments</label>
                  <div class="relative">
                    <select x-model="grapheneForm.comments"
                            @change="if($event.target.value === 'add_new') { showAddGrapheneComment = true; grapheneForm.comments = ''; }"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black appearance-none">
                      <option value="">Select comment...</option>
                      <template x-for="comment in grapheneComments" :key="comment">
                        <option :value="comment" x-text="comment"></option>
                      </template>
                      <option value="add_new" class="font-semibold">+ Add New Comment</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Base Treatment -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Base Treatment</h4>
              <div class="grid grid-cols-3 gap-4">
                <div x-html="getNumericFieldHtml({
                  label: 'Amount',
                  unit: 'g',
                  modelVariable: 'grapheneForm.baseAmount',
                  step: '0.01'
                })"></div>
                <div x-html="getSelectFieldHtml({
                  label: 'Type',
                  modelVariable: 'grapheneForm.baseType',
                  optionsArray: 'baseTypes',
                  showModalVariable: 'showAddBaseType',
                  placeholder: 'Select...',
                  addNewText: 'Base Type',
                  resetValue: ''
                })"></div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Concentration (%)</label>
                  <input type="number" step="0.01" x-model="grapheneForm.baseConcentration"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
              </div>
            </div>

            <!-- Second Base Treatment (Optional) -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Second Base (Optional)</h4>
              <div class="grid grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Amount (g)</label>
                  <input type="number" step="0.01" x-model="grapheneForm.base2Amount"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                  <div class="relative">
                    <select x-model="grapheneForm.base2Type" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md appearance-none">
                      <option value="">Select...</option>
                      <template x-for="base in baseTypes" :key="base">
                        <option :value="base" x-text="base"></option>
                      </template>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Concentration (%)</label>
                  <input type="number" step="0.01" x-model="grapheneForm.base2Concentration"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
              </div>
            </div>

            <!-- Preparation -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Preparation</h4>
              <div class="grid grid-cols-4 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Grinding Method</label>
                  <select x-model="grapheneForm.grindingMethod"
                          @change="if (grapheneForm.grindingMethod !== 'ball_mill') grapheneForm.grindingFrequency = ''"
                          class="w-full px-3 py-2 border border-gray-300 rounded-md">
                    <option value="">Select...</option>
                    <option value="manual">Manual</option>
                    <option value="mill">Mill</option>
                    <option value="ball_mill">Ball Mill</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Grinding Time (min)</label>
                  <input type="number" step="0.1" x-model="grapheneForm.grindingTime"
                         :disabled="!grapheneForm.grindingMethod || grapheneForm.grindingMethod === 'manual'"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md disabled:bg-gray-100">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Frequency (Hz)</label>
                  <input type="number" step="0.1" x-model="grapheneForm.grindingFrequency"
                         :disabled="grapheneForm.grindingMethod !== 'ball_mill'"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md disabled:bg-gray-100">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Homogeneous</label>
                  <select x-model="grapheneForm.homogeneous"
                          class="w-full px-3 py-2 border border-gray-300 rounded-md">
                    <option value="">Select...</option>
                    <option value="true">Yes</option>
                    <option value="false">No</option>
                  </select>
                </div>
              </div>
            </div>
            
            <!-- Thermal Treatment -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Thermal Treatment</h4>
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Gas</label>
                  <div class="relative">
                    <select x-model="grapheneForm.gas" 
                            @change="if($event.target.value === 'add_new') { showAddGas = true; grapheneForm.gas = ''; }"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md appearance-none">
                      <option value="">Select gas...</option>
                      <template x-for="gas in gases" :key="gas">
                        <option :value="gas" x-text="gas"></option>
                      </template>
                      <option value="add_new" class="font-semibold">+ Add New Gas</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Time (hr)</label>
                  <input type="number" step="0.1" x-model="grapheneForm.time"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Temperature Rate (°C/min)</label>
                  <input type="text" x-model="grapheneForm.tempRate" placeholder="20-27 or 3"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Max Temperature (°C)</label>
                  <input type="number" step="0.1" x-model="grapheneForm.tempMax"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
              </div>
            </div>
            
            <!-- Washing -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Washing</h4>
              <div class="grid grid-cols-4 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Amount (g)</label>
                  <input type="number" step="0.01" x-model="grapheneForm.washAmount"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Solution</label>
                  <div class="relative">
                    <select x-model="grapheneForm.washSolution" 
                            @change="if($event.target.value === 'add_new') { showAddWashSolution = true; grapheneForm.washSolution = ''; }"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md appearance-none">
                      <option value="">Select...</option>
                      <template x-for="solution in washSolutions" :key="solution">
                        <option :value="solution" x-text="solution"></option>
                      </template>
                      <option value="add_new" class="font-semibold">+ Add New</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Concentration (%)</label>
                  <input type="number" step="0.1" x-model="grapheneForm.washConcentration"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Water</label>
                  <div class="relative">
                    <select x-model="grapheneForm.washWater"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md appearance-none">
                      <option value="">None</option>
                      <template x-for="water in washWaters" :key="water">
                        <option :value="water" x-text="water"></option>
                      </template>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Drying -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Drying</h4>
              <div class="grid grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Temperature (°C)</label>
                  <input type="number" step="0.1" x-model="grapheneForm.dryingTemp"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Atmosphere</label>
                  <div class="relative">
                    <select x-model="grapheneForm.dryingAtmosphere" 
                            @change="if($event.target.value === 'add_new') { showAddDryingAtmosphere = true; grapheneForm.dryingAtmosphere = ''; }"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md appearance-none">
                      <option value="">Select...</option>
                      <template x-for="atmosphere in dryingAtmospheres" :key="atmosphere">
                        <option :value="atmosphere" x-text="atmosphere"></option>
                      </template>
                      <option value="add_new" class="font-semibold">+ Add New</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Pressure</label>
                  <div class="relative">
                    <select x-model="grapheneForm.dryingPressure" 
                            @change="if($event.target.value === 'add_new') { showAddDryingPressure = true; grapheneForm.dryingPressure = ''; }"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md appearance-none">
                      <template x-for="pressure in dryingPressures" :key="pressure">
                        <option :value="pressure" x-text="pressure"></option>
                      </template>
                      <option value="add_new" class="font-semibold">+ Add New</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Product Characterization -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Product Characterization</h4>
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Volume (ml)</label>
                  <input type="number" step="0.01" x-model="grapheneForm.volumeMl"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
              </div>
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Species</label>
                  <div class="relative">
                    <select x-model="grapheneForm.species" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black appearance-none">
                      <option value="">Select species...</option>
                      <template x-for="spec in species" :key="spec">
                        <option :value="spec" x-text="spec"></option>
                      </template>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Output (g)</label>
                  <input type="number" step="0.01" x-model="grapheneForm.output"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Appearance Tags</label>
                <div class="space-y-2">
                  <div class="flex flex-wrap gap-2">
                    <template x-for="tag in appearanceTags" :key="tag">
                      <button type="button" 
                              @click="toggleAppearanceTag(tag)"
                              :class="(grapheneForm.appearanceTags && grapheneForm.appearanceTags.includes(tag)) ? 'bg-gray-900 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                              class="px-3 py-1 text-sm rounded-full border transition-colors">
                        <span x-text="tag"></span>
                      </button>
                    </template>
                  </div>
                  <div class="flex items-center space-x-2">
                    <button type="button" @click="showAddAppearanceTag = true" 
                            class="px-3 py-1 text-sm bg-link-light text-link-medium rounded-full border border-link hover:bg-link-light">
                      + Add New Tag
                    </button>
                  </div>
                  <div x-show="grapheneForm.appearanceTags && grapheneForm.appearanceTags.length > 0" class="text-sm text-gray-600">
                    Selected: <span x-text="(grapheneForm.appearanceTags || []).join(', ')"></span>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- SEM Report Upload -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">SEM Reports (PDF)</label>
              
              <!-- Existing SEM Reports -->
              <div x-show="editingGraphene && (editingGraphene?.semReportPath || (editingGraphene?.semReports && editingGraphene.semReports.length > 0))" class="mb-3">
                <div class="text-xs text-gray-600 mb-2">Current SEM Reports:</div>
                
                <!-- Direct SEM Report -->
                <template x-if="editingGraphene?.semReportPath && !grapheneForm.removeSemReport">
                  <div class="mb-2 p-2 bg-link-light border border-link rounded">
                    <div class="flex items-center justify-between">
                      <div class="text-sm">
                        <span class="text-link-dark font-medium" x-text="editingGraphene?.semReportPath?.split('/').pop().replace(/_\d+\.pdf$/, '.pdf')"></span>
                        <span class="text-xs text-link block">Direct upload</span>
                      </div>
                      <div class="flex space-x-2">
                        <button type="button" @click="viewSemReport(editingGraphene?.semReportPath)" 
                                class="text-link text-link-hover text-sm">
                          View
                        </button>
                        <button type="button" @click="grapheneForm.removeSemReport = true" 
                                class="text-red-600 hover:text-red-900 text-sm">
                          Remove
                        </button>
                      </div>
                    </div>
                  </div>
                </template>
                
                <!-- Associated SEM Reports -->
                <template x-if="editingGraphene?.semReports && editingGraphene.semReports.length > 0">
                  <div class="space-y-2">
                    <template x-for="semReport in editingGraphene.semReports">
                      <div class="p-2 bg-gray-50 border border-gray-200 rounded">
                        <div class="flex items-center justify-between">
                          <div class="text-sm">
                            <span class="text-gray-800 font-medium" x-text="semReport.semReport.originalName"></span>
                            <span class="text-xs text-gray-600 block">Associated report</span>
                            <div x-show="semReport.semReport.description" class="text-xs text-gray-500 mt-1" x-text="semReport.semReport.description"></div>
                          </div>
                          <div class="flex space-x-2">
                            <button type="button" @click="viewSemPdf('/uploads/' + semReport.semReport.filePath)" 
                                    class="text-link text-link-hover text-sm">
                              View
                            </button>
                            <button type="button" @click="removeSemReportAssociation(semReport.semReport.id)" 
                                    class="text-red-600 hover:text-red-900 text-sm">
                              Unlink
                            </button>
                          </div>
                        </div>
                      </div>
                    </template>
                  </div>
                </template>
              </div>
              
              <!-- Show removal notice -->
              <div x-show="grapheneForm.removeSemReport" class="mb-2 p-2 bg-red-50 rounded">
                <div class="flex items-center justify-between">
                  <span class="text-sm text-red-600">Direct SEM report will be removed when you save</span>
                  <button type="button" @click="grapheneForm.removeSemReport = false" 
                          class="text-gray-600 hover:text-gray-900 text-sm">
                    Cancel
                  </button>
                </div>
              </div>
              
              <!-- Upload New Direct SEM Report -->
              <div class="border-t pt-3">
                <div class="text-sm font-medium text-gray-700 mb-2">Upload New Direct SEM Report:</div>
                
                <!-- File upload input (show if no current file, or replacing, or after removal) -->
                <div x-show="!editingGraphene || !editingGraphene?.semReportPath || grapheneForm.removeSemReport">
                  <input type="file" 
                         accept=".pdf"
                         @change="handleSemFileChange($event)"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
                  <p class="text-xs text-gray-500 mt-1">Upload PDF files only (max 10MB)</p>
                </div>
                
                <!-- Option to replace existing file -->
                <div x-show="editingGraphene && editingGraphene?.semReportPath && !grapheneForm.removeSemReport" class="mt-2">
                  <label class="text-sm text-gray-600">
                    <input type="checkbox" x-model="grapheneForm.replaceSemReport" class="mr-1">
                    Replace direct upload with new file
                  </label>
                  <div x-show="grapheneForm.replaceSemReport" class="mt-2">
                    <input type="file" 
                           accept=".pdf"
                           @change="handleSemFileChange($event)"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
                  </div>
                </div>
                
                <div x-show="grapheneForm.semReportFile" class="text-sm text-green-600 mt-1">
                  New file selected: <span x-text="grapheneForm.semReportFile?.name"></span>
                </div>
                
                <div class="text-xs text-gray-500 mt-2">
                  Note: To add more reports, use the SEM Reports page under Test Results.
                </div>
              </div>
            </div>
            
            <!-- Experiment Objective Section -->
            <div class="border-t pt-4">
              <h4 class="text-sm font-medium text-gray-700 mb-3">Experiment Objective & Results</h4>
              
              <!-- Paste Area -->
              <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Paste Full Objective Text</label>
                <textarea x-model="grapheneForm.objectivePaste" 
                          rows="4"
                          placeholder="Paste the complete objective text here (Objective, Experiment details, Result, Conclusion, Recommended action)..."
                          class="w-full px-3 py-2 border border-gray-300 rounded-md font-mono text-xs"></textarea>
                <div class="flex justify-between mt-2">
                  <button type="button" 
                          @click="parseObjective()" 
                          class="px-3 py-1 text-sm bg-link text-white rounded hover:bg-link-hover">
                    Parse Text
                  </button>
                  <button type="button" 
                          @click="clearObjectiveFields()" 
                          class="px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50">
                    Clear All
                  </button>
                </div>
              </div>
              
              <!-- Parsed Fields -->
              <div class="space-y-3" x-show="grapheneForm.objective || grapheneForm.experimentDetails || grapheneForm.result || grapheneForm.conclusion || grapheneForm.recommendedAction">
                <div x-show="grapheneForm.objective">
                  <label class="block text-sm font-medium text-gray-700 mb-1">Objective</label>
                  <textarea x-model="grapheneForm.objective" rows="2"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm"></textarea>
                </div>
                
                <div x-show="grapheneForm.experimentDetails">
                  <label class="block text-sm font-medium text-gray-700 mb-1">Experiment Details</label>
                  <textarea x-model="grapheneForm.experimentDetails" rows="3"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm"></textarea>
                </div>
                
                <div x-show="grapheneForm.result">
                  <label class="block text-sm font-medium text-gray-700 mb-1">Result</label>
                  <textarea x-model="grapheneForm.result" rows="2"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm"></textarea>
                </div>
                
                <div x-show="grapheneForm.conclusion">
                  <label class="block text-sm font-medium text-gray-700 mb-1">Conclusion</label>
                  <textarea x-model="grapheneForm.conclusion" rows="2"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm"></textarea>
                </div>
                
                <div x-show="grapheneForm.recommendedAction">
                  <label class="block text-sm font-medium text-gray-700 mb-1">Recommended Action</label>
                  <textarea x-model="grapheneForm.recommendedAction" rows="2"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm"></textarea>
                </div>
              </div>
            </div>
            
            <!-- Update Reports Association -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Associated Update Reports</label>
              <div class="border border-gray-300 rounded-md p-3 max-h-32 overflow-y-auto">
                <template x-for="report in updateReports" :key="report.id">
                  <label class="flex items-center space-x-2 py-1">
                    <input type="checkbox" 
                           :checked="grapheneForm.updateReportIds && grapheneForm.updateReportIds.includes(report.id)"
                           @change="toggleUpdateReportSelection(report.id)"
                           class="rounded border-gray-300 focus:ring-black">
                    <span class="text-sm">
                      <strong x-text="report.originalName"></strong>
                      <span class="text-gray-500" x-show="report.weekOf"> - Week of <span x-text="new Date(report.weekOf).toLocaleDateString()"></span></span>
                    </span>
                  </label>
                </template>
                <template x-if="updateReports.length === 0">
                  <div class="text-sm text-gray-500 text-center py-2">No update reports available</div>
                </template>
              </div>
              <p class="text-xs text-gray-500 mt-1">Select update reports that mention this experiment</p>
            </div>
            
            <div class="flex justify-end space-x-2 pt-4">
              <button type="button" @click="showAddGraphene = false; editingGraphene = null; grapheneForm = {}"
                      class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">
                Cancel
              </button>
              <button type="submit"
                      class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">
                Save
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- Add New Material Modal -->
    <div x-show="showAddMaterial" x-cloak
         @click.away="showAddMaterial = false; newMaterial = ''"
         class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-md w-full p-6">
          <h3 class="text-lg font-semibold mb-4">Add New Raw Material</h3>
          
          <form @submit.prevent="addNewMaterial()">
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-1">Material Name</label>
              <input type="text" x-model="newMaterial" required
                     class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black"
                     placeholder="Enter material name...">
            </div>
            
            <div class="flex justify-end space-x-2">
              <button type="button" @click="showAddMaterial = false; newMaterial = ''"
                      class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">
                Cancel
              </button>
              <button type="submit"
                      class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">
                Add Material
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- Add New Acid Type Modal -->
    <div x-show="showAddAcidType" x-cloak @click.away="showAddAcidType = false; newAcidType = ''" class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-md w-full p-6">
          <h3 class="text-lg font-semibold mb-4">Add New Acid Type</h3>
          <form @submit.prevent="addNewAcidType()">
            <input type="text" x-model="newAcidType" required placeholder="Enter acid type..." class="w-full px-3 py-2 border border-gray-300 rounded-md mb-4">
            <div class="flex justify-end space-x-2">
              <button type="button" @click="showAddAcidType = false; newAcidType = ''" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">Cancel</button>
              <button type="submit" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">Add</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- Add New Wash Medium Modal -->
    <div x-show="showAddWashMedium" x-cloak @click.away="showAddWashMedium = false; newWashMedium = ''" class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-md w-full p-6">
          <h3 class="text-lg font-semibold mb-4">Add New Wash Medium</h3>
          <form @submit.prevent="addNewWashMedium()">
            <input type="text" x-model="newWashMedium" required placeholder="Enter wash medium..." class="w-full px-3 py-2 border border-gray-300 rounded-md mb-4">
            <div class="flex justify-end space-x-2">
              <button type="button" @click="showAddWashMedium = false; newWashMedium = ''" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">Cancel</button>
              <button type="submit" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">Add</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- Add New Reactor Modal -->
    <div x-show="showAddReactor" x-cloak @click.away="showAddReactor = false; newReactor = ''" class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-md w-full p-6">
          <h3 class="text-lg font-semibold mb-4">Add New Reactor</h3>
          <form @submit.prevent="addNewReactor()">
            <input type="text" x-model="newReactor" required placeholder="Enter reactor name..." class="w-full px-3 py-2 border border-gray-300 rounded-md mb-4">
            <div class="flex justify-end space-x-2">
              <button type="button" @click="showAddReactor = false; newReactor = ''" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">Cancel</button>
              <button type="submit" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">Add</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- Add New Base Type Modal -->
    <div x-show="showAddBaseType" x-cloak @click.away="showAddBaseType = false; newBaseType = ''" class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-md w-full p-6">
          <h3 class="text-lg font-semibold mb-4">Add New Base Type</h3>
          <form @submit.prevent="addNewBaseType()">
            <input type="text" x-model="newBaseType" required placeholder="Enter base type..." class="w-full px-3 py-2 border border-gray-300 rounded-md mb-4">
            <div class="flex justify-end space-x-2">
              <button type="button" @click="showAddBaseType = false; newBaseType = ''" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">Cancel</button>
              <button type="submit" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">Add</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- Add New Gas Modal -->
    <div x-show="showAddGas" x-cloak @click.away="showAddGas = false; newGas = ''" class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-md w-full p-6">
          <h3 class="text-lg font-semibold mb-4">Add New Gas</h3>
          <form @submit.prevent="addNewGas()">
            <input type="text" x-model="newGas" required placeholder="Enter gas type..." class="w-full px-3 py-2 border border-gray-300 rounded-md mb-4">
            <div class="flex justify-end space-x-2">
              <button type="button" @click="showAddGas = false; newGas = ''" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">Cancel</button>
              <button type="submit" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">Add</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- Add New Wash Solution Modal -->
    <div x-show="showAddWashSolution" x-cloak @click.away="showAddWashSolution = false; newWashSolution = ''" class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-md w-full p-6">
          <h3 class="text-lg font-semibold mb-4">Add New Wash Solution</h3>
          <form @submit.prevent="addNewWashSolution()">
            <input type="text" x-model="newWashSolution" required placeholder="Enter wash solution..." class="w-full px-3 py-2 border border-gray-300 rounded-md mb-4">
            <div class="flex justify-end space-x-2">
              <button type="button" @click="showAddWashSolution = false; newWashSolution = ''" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">Cancel</button>
              <button type="submit" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">Add</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- Add New Drying Atmosphere Modal -->
    <div x-show="showAddDryingAtmosphere" x-cloak @click.away="showAddDryingAtmosphere = false; newDryingAtmosphere = ''" class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-md w-full p-6">
          <h3 class="text-lg font-semibold mb-4">Add New Drying Atmosphere</h3>
          <form @submit.prevent="addNewDryingAtmosphere()">
            <input type="text" x-model="newDryingAtmosphere" required placeholder="Enter atmosphere..." class="w-full px-3 py-2 border border-gray-300 rounded-md mb-4">
            <div class="flex justify-end space-x-2">
              <button type="button" @click="showAddDryingAtmosphere = false; newDryingAtmosphere = ''" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">Cancel</button>
              <button type="submit" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">Add</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- Add New Oven Modal -->
    <div x-show="showAddOven" x-cloak @click.away="showAddOven = false; newOven = ''" class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-md w-full p-6">
          <h3 class="text-lg font-semibold mb-4">Add New Oven</h3>
          <form @submit.prevent="addNewOven()">
            <input type="text" x-model="newOven" required placeholder="Enter oven identifier..." class="w-full px-3 py-2 border border-gray-300 rounded-md mb-4">
            <div class="flex justify-end space-x-2">
              <button type="button" @click="showAddOven = false; newOven = ''" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">Cancel</button>
              <button type="submit" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">Add</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Add New Drying Pressure Modal -->
    <div x-show="showAddDryingPressure" x-cloak @click.away="showAddDryingPressure = false; newDryingPressure = ''" class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-md w-full p-6">
          <h3 class="text-lg font-semibold mb-4">Add New Drying Pressure</h3>
          <form @submit.prevent="addNewDryingPressure()">
            <input type="text" x-model="newDryingPressure" placeholder="Enter drying pressure..." 
                   class="w-full px-3 py-2 border border-gray-300 rounded-md mb-4" autofocus>
            <div class="flex justify-end space-x-2">
              <button type="button" @click="showAddDryingPressure = false; newDryingPressure = ''" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">Cancel</button>
              <button type="submit" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">Add</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Add New Appearance Tag Modal -->
    <div x-show="showAddAppearanceTag" x-cloak @click.away="showAddAppearanceTag = false; newAppearanceTag = ''" class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-md w-full p-6">
          <h3 class="text-lg font-semibold mb-4">Add New Appearance Tag</h3>
          <form @submit.prevent="addNewAppearanceTag()">
            <input type="text" x-model="newAppearanceTag" placeholder="Enter appearance tag..." 
                   class="w-full px-3 py-2 border border-gray-300 rounded-md mb-4" autofocus>
            <div class="flex justify-end space-x-2">
              <button type="button" @click="showAddAppearanceTag = false; newAppearanceTag = ''" 
                      class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">Cancel</button>
              <button type="submit" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">Add Tag</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Combine Biochar into Lot Modal -->
    <div x-show="showCombineModal" x-cloak
         @click.away="showCombineModal = false; selectedBiocharIds = []; combineForm = {lotNumber: '', lotName: '', description: ''}"
         class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6">
          <h3 class="text-lg font-semibold mb-4">Combine Biochar Experiments into Lot</h3>
          
          <form @submit.prevent="combineBiocharIntoLot()" class="space-y-4">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Lot Number *</label>
                <input type="text" x-model="combineForm.lotNumber" required
                       placeholder="LOT-001"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Lot Name</label>
                <input type="text" x-model="combineForm.lotName"
                       placeholder="High Temperature Batch"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
              </div>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
              <textarea x-model="combineForm.description" rows="3"
                        placeholder="Combined experiments with similar parameters..."
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black"></textarea>
            </div>
            
            <div>
              <h4 class="font-medium text-gray-700 mb-2">Selected Experiments (<span x-text="selectedBiocharIds.length"></span>)</h4>
              <div class="max-h-48 overflow-y-auto border border-gray-200 rounded-md">
                <template x-for="id in selectedBiocharIds" :key="id">
                  <div class="px-3 py-2 border-b border-gray-100 text-sm">
                    <span x-text="biocharRecords.find(r => r.id === id)?.experimentNumber"></span>
                    <span class="text-gray-500 ml-2" x-text="'- ' + formatDate(biocharRecords.find(r => r.id === id)?.experimentDate)"></span>
                  </div>
                </template>
                <div x-show="selectedBiocharIds.length === 0" class="px-3 py-4 text-sm text-gray-500 text-center">
                  No experiments selected. Please select experiments from the table above.
                </div>
              </div>
            </div>
            
            <div class="flex justify-end space-x-3">
              <button type="button" @click="showCombineModal = false; selectedBiocharIds = []; combineForm = {lotNumber: '', lotName: '', description: ''}" 
                      class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">
                Cancel
              </button>
              <button type="submit" 
                      :disabled="selectedBiocharIds.length === 0 || !combineForm.lotNumber"
                      :class="{'opacity-50 cursor-not-allowed': selectedBiocharIds.length === 0 || !combineForm.lotNumber}"
                      class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">
                Create Lot
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- BET Add/Edit Modal -->
    <div x-show="showAddBet" x-cloak
         @click.away="showAddBet = false; editingBet = null"
         class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6">
          <h3 class="text-lg font-semibold mb-4" x-text="editingBet ? 'Edit BET Record' : 'Add BET Record'"></h3>
          
          <form @submit.prevent="saveBet()" class="space-y-4">
            <div class="grid grid-cols-1 gap-4">
              <div x-html="getDateFieldHtml({
                label: 'Test Date', 
                dateModelVariable: 'betForm.testDate',
                unknownModelVariable: 'betForm.dateUnknown'
              })"></div>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Graphene Sample</label>
                <select x-model="betForm.grapheneSample" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
                  <option value="">Select graphene sample...</option>
                  <template x-for="exp in availableGrapheneSamples" :key="exp">
                    <option :value="exp" x-text="exp"></option>
                  </template>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Species</label>
                <select x-model="betForm.species" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
                  <option value="">Select species...</option>
                  <template x-for="spec in species" :key="spec">
                    <option :value="spec" x-text="spec"></option>
                  </template>
                </select>
              </div>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Research Team</label>
                <select x-model="betForm.researchTeam" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
                  <template x-for="team in researchTeams" :key="team">
                    <option :value="team" x-text="team"></option>
                  </template>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Testing Lab</label>
                <select x-model="betForm.testingLab" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
                  <template x-for="lab in testingLabs" :key="lab">
                    <option :value="lab" x-text="lab"></option>
                  </template>
                </select>
              </div>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
              <div x-html="getNumericFieldHtml({
                label: 'Multipoint BET Area',
                unit: 'm²/g',
                modelVariable: 'betForm.multipointBetArea',
                inputType: 'text',
                placeholder: '1.520e3 or 1520'
              })"></div>
              <div x-html="getNumericFieldHtml({
                label: 'Langmuir Surface Area',
                unit: 'm²/g',
                modelVariable: 'betForm.langmuirSurfaceArea',
                inputType: 'text',
                placeholder: '2.340e3 or 2340'
              })"></div>
            </div>
            
            <div x-html="getFileFieldHtml({
              label: 'BET Report (PDF)',
              fileModelVariable: 'betForm.betReportFile',
              editingVariable: 'editingBet',
              currentFilePathField: 'betReportPath',
              removeFileVariable: 'betForm.removeBetReport'
            })"></div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Comments</label>
              <textarea x-model="betForm.comments" rows="3"
                        placeholder="Additional notes about the BET analysis..."
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black"></textarea>
            </div>
            
            <div class="flex justify-end space-x-3">
              <button type="button" @click="showAddBet = false; editingBet = null; betForm = {}" 
                      class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">
                Cancel
              </button>
              <button type="submit" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">
                <span x-text="editingBet ? 'Update' : 'Create'"></span> Record
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Conductivity Add/Edit Modal -->
    <div x-show="showAddConductivity" x-cloak
         @click.away="showAddConductivity = false; editingConductivity = null"
         class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6">
          <h3 class="text-lg font-semibold mb-4" x-text="editingConductivity ? 'Edit Conductivity Test' : 'Add Conductivity Test'"></h3>
          
          <form @submit.prevent="saveConductivity()" class="space-y-4">
            <div class="grid grid-cols-1 gap-4">
              <div x-html="getDateFieldHtml({
                label: 'Test Date', 
                dateModelVariable: 'conductivityForm.testDate',
                unknownModelVariable: 'conductivityForm.dateUnknown'
              })"></div>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Graphene Sample</label>
              <select x-model="conductivityForm.grapheneSample" 
                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
                <option value="">Select graphene sample...</option>
                <template x-for="exp in availableGrapheneSamples" :key="exp">
                  <option :value="exp" x-text="exp"></option>
                </template>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
              <textarea x-model="conductivityForm.description" rows="3"
                        placeholder="Test conditions, setup, methodology..."
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black"></textarea>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">1kN Conductivity (S/cm²)</label>
                <input type="number" step="any" x-model="conductivityForm.conductivity1kN" 
                       placeholder="0.000001"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">8kN Conductivity (S/cm²)</label>
                <input type="number" step="any" x-model="conductivityForm.conductivity8kN" 
                       placeholder="0.000001"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
              </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">12kN Conductivity (S/cm²)</label>
                <input type="number" step="any" x-model="conductivityForm.conductivity12kN" 
                       placeholder="0.000001"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">20kN Conductivity (S/cm²)</label>
                <input type="number" step="any" x-model="conductivityForm.conductivity20kN" 
                       placeholder="0.000001"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
              </div>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Comments</label>
              <textarea x-model="conductivityForm.comments" rows="3"
                        placeholder="Additional notes about the conductivity test..."
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black"></textarea>
            </div>
            
            <div class="flex justify-end space-x-3">
              <button type="button" @click="showAddConductivity = false; editingConductivity = null; conductivityForm = {}" 
                      class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">
                Cancel
              </button>
              <button type="submit" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">
                <span x-text="editingConductivity ? 'Update' : 'Create'"></span> Record
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- RAMAN Add/Edit Modal -->
    <div x-show="showAddRaman" x-cloak
         @click.away="showAddRaman = false; editingRaman = null"
         class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto p-6">
          <h3 class="text-lg font-semibold mb-4" x-text="editingRaman ? 'Edit RAMAN Test' : 'Add RAMAN Test'"></h3>
          
          <form @submit.prevent="saveRaman()" class="space-y-6">
            <!-- Basic Information -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Basic Information</h4>
              <div class="grid grid-cols-2 gap-4">
                <div x-html="getDateFieldHtml({
                  label: 'Test Date', 
                  dateModelVariable: 'ramanForm.testDate',
                  unknownModelVariable: 'ramanForm.dateUnknown'
                })"></div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Graphene Sample *</label>
                  <select x-model="ramanForm.grapheneSample" required
                          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
                    <option value="">Select graphene sample...</option>
                    <template x-for="exp in availableGrapheneSamples" :key="exp">
                      <option :value="exp" x-text="exp"></option>
                    </template>
                  </select>
                </div>
              </div>
            </div>

            <!-- Team and Lab Information -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Team & Lab Information</h4>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Research Team</label>
                  <select x-model="ramanForm.researchTeam" 
                          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
                    <option value="">Select research team...</option>
                    <template x-for="team in researchTeams" :key="team">
                      <option :value="team" x-text="team"></option>
                    </template>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Testing Lab</label>
                  <select x-model="ramanForm.testingLab" 
                          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
                    <option value="">Select testing lab...</option>
                    <template x-for="lab in testingLabs" :key="lab">
                      <option :value="lab" x-text="lab"></option>
                    </template>
                  </select>
                </div>
              </div>
            </div>

            <!-- Absorption Band Data Matrix -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Absorption Band Analysis</h4>
              <table class="w-full border border-gray-300">
                <thead class="bg-gray-100">
                  <tr>
                    <th class="px-3 py-2 text-left text-sm font-medium text-gray-700 border-r border-gray-300">Absorption Band</th>
                    <th class="px-3 py-2 text-center text-sm font-medium text-gray-700 border-r border-gray-300">2D Band</th>
                    <th class="px-3 py-2 text-center text-sm font-medium text-gray-700 border-r border-gray-300">G Band</th>
                    <th class="px-3 py-2 text-center text-sm font-medium text-gray-700 border-r border-gray-300">D Band</th>
                    <th class="px-3 py-2 text-center text-sm font-medium text-gray-700">D/G Ratio</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Integration Range Row -->
                  <tr class="border-t border-gray-300">
                    <td class="px-3 py-2 text-sm font-medium text-gray-700 border-r border-gray-300 bg-gray-50">Integration Range</td>
                    <td class="px-1 py-1 border-r border-gray-300">
                      <div class="grid grid-cols-2 gap-1">
                        <input type="number" step="any" x-model="ramanForm.integrationRange2DLow" 
                               placeholder="2791"
                               class="w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-black">
                        <input type="number" step="any" x-model="ramanForm.integrationRange2DHigh" 
                               placeholder="2557"
                               class="w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-black">
                      </div>
                    </td>
                    <td class="px-1 py-1 border-r border-gray-300">
                      <div class="grid grid-cols-2 gap-1">
                        <input type="number" step="any" x-model="ramanForm.integrationRangeGLow" 
                               placeholder="1753.2"
                               class="w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-black">
                        <input type="number" step="any" x-model="ramanForm.integrationRangeGHigh" 
                               placeholder="1474"
                               class="w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-black">
                      </div>
                    </td>
                    <td class="px-1 py-1 border-r border-gray-300">
                      <div class="grid grid-cols-2 gap-1">
                        <input type="number" step="any" x-model="ramanForm.integrationRangeDLow" 
                               placeholder="1474"
                               class="w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-black">
                        <input type="number" step="any" x-model="ramanForm.integrationRangeDHigh" 
                               placeholder="959"
                               class="w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-black">
                      </div>
                    </td>
                    <td class="px-1 py-1">
                      <div class="grid grid-cols-2 gap-1">
                        <input type="number" step="any" x-model="ramanForm.integrationRangeDGLow" 
                               placeholder="1.0"
                               class="w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-black">
                        <input type="number" step="any" x-model="ramanForm.integrationRangeDGHigh" 
                               placeholder="1.451"
                               class="w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-black">
                      </div>
                    </td>
                  </tr>
                  <!-- Integral Typ A Row -->
                  <tr class="border-t border-gray-300">
                    <td class="px-3 py-2 text-sm font-medium text-gray-700 border-r border-gray-300 bg-gray-50">Integral Typ A</td>
                    <td class="px-1 py-1 border-r border-gray-300">
                      <div class="grid grid-cols-2 gap-1">
                        <input type="number" step="any" x-model="ramanForm.integralTypA2D1" 
                               placeholder="2581"
                               class="w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-black">
                        <input type="number" step="any" x-model="ramanForm.integralTypA2D2" 
                               placeholder="0"
                               class="w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-black">
                      </div>
                    </td>
                    <td class="px-1 py-1 border-r border-gray-300">
                      <div class="grid grid-cols-2 gap-1">
                        <input type="number" step="any" x-model="ramanForm.integralTypAG1" 
                               placeholder="228"
                               class="w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-black">
                        <input type="number" step="any" x-model="ramanForm.integralTypAG2" 
                               placeholder="0"
                               class="w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-black">
                      </div>
                    </td>
                    <td class="px-1 py-1 border-r border-gray-300">
                      <div class="grid grid-cols-2 gap-1">
                        <input type="number" step="any" x-model="ramanForm.integralTypAD1" 
                               placeholder="330"
                               class="w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-black">
                        <input type="number" step="any" x-model="ramanForm.integralTypAD2" 
                               placeholder="8"
                               class="w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-black">
                      </div>
                    </td>
                    <td class="px-1 py-1">
                      <div class="grid grid-cols-2 gap-1">
                        <input type="number" step="any" x-model="ramanForm.integralTypADG1" 
                               placeholder="1"
                               class="w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-black">
                        <input type="number" step="any" x-model="ramanForm.integralTypADG2" 
                               placeholder="451"
                               class="w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-black">
                      </div>
                    </td>
                  </tr>
                  <!-- Peak High Typ J Row -->
                  <tr class="border-t border-gray-300">
                    <td class="px-3 py-2 text-sm font-medium text-gray-700 border-r border-gray-300 bg-gray-50">Peak High Typ J</td>
                    <td class="px-1 py-1 border-r border-gray-300">
                      <div class="grid grid-cols-2 gap-1">
                        <input type="number" step="any" x-model="ramanForm.peakHighTypJ2D1" 
                               placeholder="0.024"
                               class="w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-black">
                        <input type="number" step="any" x-model="ramanForm.peakHighTypJ2D2" 
                               placeholder="0"
                               class="w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-black">
                      </div>
                    </td>
                    <td class="px-1 py-1 border-r border-gray-300">
                      <div class="grid grid-cols-2 gap-1">
                        <input type="number" step="any" x-model="ramanForm.peakHighTypJG1" 
                               placeholder="1.972"
                               class="w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-black">
                        <input type="number" step="any" x-model="ramanForm.peakHighTypJG2" 
                               placeholder="0"
                               class="w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-black">
                      </div>
                    </td>
                    <td class="px-1 py-1 border-r border-gray-300">
                      <div class="grid grid-cols-2 gap-1">
                        <input type="number" step="any" x-model="ramanForm.peakHighTypJD1" 
                               placeholder="1.784"
                               class="w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-black">
                        <input type="number" step="any" x-model="ramanForm.peakHighTypJD2" 
                               placeholder="0"
                               class="w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-black">
                      </div>
                    </td>
                    <td class="px-1 py-1">
                      <div class="grid grid-cols-2 gap-1">
                        <input type="number" step="any" x-model="ramanForm.peakHighTypJDG1" 
                               placeholder="0.905"
                               class="w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-black">
                        <input type="number" step="any" x-model="ramanForm.peakHighTypJDG2" 
                               placeholder="0"
                               class="w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-black">
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- PDF Upload -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">RAMAN Report</h4>
              <template x-if="editingRaman && editingRaman.ramanReportPath">
                <div class="mb-3 p-3 bg-link-light rounded-md">
                  <div class="flex items-center justify-between">
                    <span class="text-sm text-link-dark">Current report: RAMAN Report PDF</span>
                    <div class="flex space-x-2">
                      <button type="button" @click="viewRamanPdf(editingRaman.ramanReportPath)" 
                              class="text-link text-link-hover text-sm">View</button>
                      <button type="button" @click="ramanForm.removeRamanReport = true; ramanForm.replacementFile = null" 
                              class="text-red-600 hover:text-red-800 text-sm">Remove</button>
                    </div>
                  </div>
                </div>
              </template>
              
              <template x-if="!editingRaman || !editingRaman.ramanReportPath || ramanForm.removeRamanReport">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">
                    <span x-show="!editingRaman">Upload RAMAN Report (Optional)</span>
                    <span x-show="editingRaman && (!editingRaman.ramanReportPath || ramanForm.removeRamanReport)">Upload New RAMAN Report</span>
                  </label>
                  <input type="file" 
                         @change="ramanForm.ramanReportFile = $event.target.files[0]" 
                         accept="application/pdf"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
                  <p class="text-xs text-gray-500 mt-1">PDF files only, max 10MB</p>
                </div>
              </template>
              
              <template x-if="editingRaman && editingRaman.ramanReportPath && !ramanForm.removeRamanReport">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Replace RAMAN Report (Optional)</label>
                  <input type="file" 
                         @change="ramanForm.ramanReportFile = $event.target.files[0]" 
                         accept="application/pdf"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
                  <p class="text-xs text-gray-500 mt-1">PDF files only, max 10MB. Leave empty to keep current report.</p>
                </div>
              </template>
            </div>

            <!-- Comments -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Comments</label>
              <textarea x-model="ramanForm.comments" rows="3"
                        placeholder="Additional notes about the RAMAN analysis..."
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black"></textarea>
            </div>
            
            <div class="flex justify-end space-x-3">
              <button type="button" @click="showAddRaman = false; editingRaman = null; ramanForm = {}" 
                      class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">
                Cancel
              </button>
              <button type="submit" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">
                <span x-text="editingRaman ? 'Update' : 'Create'"></span> Record
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Add/Edit Update Report Modal -->
    <div x-show="showAddUpdateReport" x-cloak
         @click.away="closeUpdateReportForm()"
         class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto">
          <h3 class="text-lg font-semibold mb-4" 
              x-text="editingUpdateReport ? 'Edit Update Report' : 'Upload Update Report'"></h3>
          
          <form @submit.prevent="saveUpdateReport()" class="space-y-4">
            <template x-if="!editingUpdateReport">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Update Report File *</label>
                <input type="file" 
                       @change="handleUpdateFileChange($event)" 
                       accept="application/pdf"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
                <p class="text-xs text-gray-500 mt-1">PDF files only, max 50MB</p>
              </div>
            </template>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Week Of</label>
              <input type="date" x-model="updateReportForm.weekOf" 
                     class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
              <textarea x-model="updateReportForm.description" rows="3"
                        placeholder="Brief description of the update report content..."
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black"></textarea>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Associated Graphene Experiments</label>
              <div class="border border-gray-300 rounded-md p-3 max-h-40 overflow-y-auto">
                <template x-for="graphene in grapheneRecords" :key="graphene.id">
                  <label class="flex items-center space-x-2 py-1">
                    <input type="checkbox" 
                           :checked="updateReportForm.grapheneIds.includes(graphene.id)"
                           @change="toggleGrapheneSelection(graphene.id)"
                           class="rounded border-gray-300 focus:ring-black">
                    <span class="text-sm">
                      <strong x-text="graphene.experimentNumber"></strong>
                      <span class="text-gray-500" x-show="graphene.species"> - <span x-text="graphene.species"></span></span>
                    </span>
                  </label>
                </template>
                <template x-if="grapheneRecords.length === 0">
                  <div class="text-sm text-gray-500 text-center py-2">No graphene experiments available</div>
                </template>
              </div>
              <p class="text-xs text-gray-500 mt-1">Select all experiments mentioned in this update report</p>
            </div>
            
            <div class="flex justify-end space-x-3">
              <button type="button" @click="closeUpdateReportForm()" 
                      class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">
                Cancel
              </button>
              <button type="submit" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">
                <span x-text="editingUpdateReport ? 'Update' : 'Upload'"></span>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Add/Edit SEM Report Modal -->
    <div x-show="showAddSemReport" x-cloak
         @click.away="closeSemReportForm()"
         class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto">
          <h3 class="text-lg font-semibold mb-4" 
              x-text="editingSemReport ? 'Edit SEM Report' : 'Upload SEM Reports'"></h3>
          
          <form @submit.prevent="saveSemReport()" class="space-y-4">
            <template x-if="!editingSemReport">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">SEM Report Files *</label>
                <input type="file" 
                       x-ref="semFileInput"
                       @change="semReportForm.semFiles = Array.from($refs.semFileInput.files); console.log('Files selected:', semReportForm.semFiles)" 
                       accept="application/pdf"
                       multiple
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
                <p class="text-xs text-gray-500 mt-1">PDF files only, max 10MB each, up to 10 files at once</p>
                <template x-if="semReportForm.semFiles && semReportForm.semFiles.length > 0">
                  <div class="mt-2 text-sm text-gray-600">
                    Selected: <span x-text="semReportForm.semFiles.length"></span> file(s)
                  </div>
                </template>
              </div>
            </template>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Report Date</label>
              <input type="date" x-model="semReportForm.reportDate" 
                     class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
              <p class="text-xs text-gray-500 mt-1">Date when the SEM analysis was performed</p>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Associated Graphene Experiments</label>
              <div class="border border-gray-300 rounded-md p-3 max-h-40 overflow-y-auto">
                <template x-for="graphene in grapheneRecords" :key="graphene.id">
                  <label class="flex items-center space-x-2 py-1">
                    <input type="checkbox" 
                           :checked="semReportForm.grapheneIds.includes(graphene.id)"
                           @change="toggleSemGrapheneSelection(graphene.id)"
                           class="rounded border-gray-300 focus:ring-black">
                    <span class="text-sm">
                      <strong x-text="graphene.experimentNumber"></strong>
                      <span class="text-gray-500" x-show="graphene.species"> - <span x-text="graphene.species"></span></span>
                    </span>
                  </label>
                </template>
                <template x-if="grapheneRecords.length === 0">
                  <p class="text-sm text-gray-500">No graphene experiments available</p>
                </template>
              </div>
            </div>
            
            <div class="flex justify-end space-x-2">
              <button type="button" 
                      @click="closeSemReportForm()"
                      class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">
                Cancel
              </button>
              <button type="submit" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">
                <span x-text="editingSemReport ? 'Update' : 'Upload'"></span>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>


    <!-- Update Report Viewer Modal (Using Dynamic Helper) -->
    <div x-html="getPdfViewerModalHtml({
      showVariable: 'showUpdateReportModal',
      pdfSourceVariable: 'currentUpdateReport',
      closeMethod: 'closeUpdateReportModal',
      title: 'Update Report'
    })"></div>
    
    <!-- SEM Report Modal (Using Dynamic Helper) -->
    <div x-html="getPdfViewerModalHtml({
      showVariable: 'showSemModal',
      pdfSourceVariable: 'currentSemPdf',
      closeMethod: 'closeSemModal',
      title: 'SEM Report'
    })"></div>

    <!-- RAMAN Report Modal (Using Dynamic Helper) -->
    <div x-html="getPdfViewerModalHtml({
      showVariable: 'showRamanModal',
      pdfSourceVariable: 'currentRamanPdf',
      closeMethod: 'closeRamanModal',
      title: 'RAMAN Report'
    })"></div>

    <!-- Add New Research Team Modal (Using Dynamic Helper) -->
    <div x-html="getModalHtml('addResearchTeam')"></div>

    <!-- Add New Graphene Comment Modal (Using Dynamic Helper) -->
    <div x-html="getModalHtml('addGrapheneComment')"></div>
    
    <!-- All Other Add New Modals (Using Dynamic Helpers) -->
    <div x-html="getModalHtml('addMaterial')"></div>
    <div x-html="getModalHtml('addReactor')"></div>
    <div x-html="getModalHtml('addBaseType')"></div>
    <div x-html="getModalHtml('addOven')"></div>
    <div x-html="getModalHtml('addAppearanceTag')"></div>
    <div x-html="getModalHtml('addAcidType')"></div>
    <div x-html="getModalHtml('addWashMedium')"></div>
    <div x-html="getModalHtml('addGas')"></div>
    <div x-html="getModalHtml('addWashSolution')"></div>
    <div x-html="getModalHtml('addDryingAtmosphere')"></div>
    <div x-html="getModalHtml('addDryingPressure')"></div>
    
  </div>

  <!-- Use modules for better code organization -->
  <script type="module" src="/src/js/app-refactored.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</body>
</html>