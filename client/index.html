<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HGraphene Production Control</title>
  <link rel="stylesheet" href="/src/styles/main.css">
</head>
<body class="bg-white text-gray-900 font-sans">
  <div id="app" x-data="grapheneApp()">
    <!-- Header -->
    <header class="border-b border-gray-200 bg-white">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
          <h1 class="text-2xl font-bold tracking-tight">HGRAPHENE</h1>
          <div class="flex items-center space-x-4">
            <span class="text-sm text-gray-500" x-text="new Date().toLocaleDateString()"></span>
          </div>
        </div>
      </div>
    </header>

    <!-- Navigation Tabs -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-6">
      <div class="border-b border-gray-200">
        <nav class="-mb-px flex space-x-8">
          <button
            @click="activeTab = 'biochar'"
            :class="activeTab === 'biochar' ? 'border-black text-gray-900' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
            class="py-2 px-1 border-b-2 font-medium text-sm transition-colors"
          >
            Biochar Production
          </button>
          <button
            @click="activeTab = 'graphene'"
            :class="activeTab === 'graphene' ? 'border-black text-gray-900' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
            class="py-2 px-1 border-b-2 font-medium text-sm transition-colors"
          >
            Graphene Production
          </button>
          <button
            @click="activeTab = 'bet'"
            :class="activeTab === 'bet' ? 'border-black text-gray-900' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
            class="py-2 px-1 border-b-2 font-medium text-sm transition-colors"
          >
            BET Analysis
          </button>
        </nav>
      </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- Biochar Tab -->
      <div x-show="activeTab === 'biochar'" x-cloak>
        <div class="mb-6 flex justify-between items-center">
          <h2 class="text-xl font-semibold">Biochar Production Records</h2>
          <div class="flex space-x-2">
            <button @click="exportData('biochar')" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">
              Export CSV
            </button>
            <button @click="showCombineModal = true" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50"
                    :class="{'opacity-50 cursor-not-allowed': biocharRecords.length === 0}"
                    :disabled="biocharRecords.length === 0">
              Combine into Lot
            </button>
            <button @click="biocharForm = {experimentNumber: '', testOrder: '', experimentDate: '', dateUnknown: false, researchTeam: 'Curia - Germany', reactor: '', rawMaterial: '', startingAmount: '', acidAmount: '', acidConcentration: '', acidMolarity: '', acidType: '', temperature: '', time: '', pressureInitial: '', pressureFinal: '', washAmount: '', washMedium: '', output: '', dryingTemp: '', kftPercentage: '', comments: ''}; editingBiochar = null; showAddBiochar = true" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">
              Add Record
            </button>
          </div>
        </div>

        <!-- Search Bar -->
        <div class="mb-4">
          <input
            type="text"
            x-model="biocharSearch"
            @input="searchBiochar()"
            placeholder="Search experiments, materials..."
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black"
          >
        </div>

        <!-- Biochar Table -->
        <div class="overflow-x-auto border border-gray-200 rounded-lg">
          <table class="min-w-full divide-y divide-gray-200">
            <thead>
              <!-- Main Header Row -->
              <tr class="bg-gray-100">
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Select</th>
                <th colspan="4" class="px-2 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Basic Info</th>
                <th colspan="2" class="px-2 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Material</th>
                <th colspan="8" class="px-2 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Process</th>
                <th colspan="5" class="px-2 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Output</th>
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Lot #</th>
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Actions</th>
              </tr>
              <!-- Sub-Header Row -->
              <tr class="bg-gray-50">
                <!-- Basic Info sub-headers -->
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Order</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Exp #</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Date</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-300">Reactor</th>
                <!-- Material sub-headers -->
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Raw Material</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-300">Start (g)</th>
                <!-- Process sub-headers -->
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Acid Amt</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Acid %</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Molarity</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Acid Type</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Temp</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Time</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">P Initial</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-300">P Final</th>
                <!-- Output sub-headers -->
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Wash Amt</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Wash Med</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Drying</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Output (g)</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-300">KFT %</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <template x-for="record in biocharRecords" :key="record.id">
                <tr class="hover:bg-gray-50" :class="{'bg-blue-50': record.lotNumber}">
                  <!-- Select checkbox -->
                  <td class="px-2 py-2 text-xs border-r border-gray-300">
                    <input type="checkbox" x-model="selectedBiocharIds" :value="record.id" 
                           :disabled="record.lotNumber"
                           class="rounded border-gray-300" 
                           :class="{'opacity-50 cursor-not-allowed': record.lotNumber}">
                  </td>
                  <!-- Basic Info columns -->
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.testOrder || '-'"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200">
                    <button 
                      @click="toggleBiocharExpansion(record.experimentNumber)" 
                      class="text-blue-600 hover:text-blue-800 underline cursor-pointer"
                      x-text="record.experimentNumber">
                    </button>
                  </td>
                  <td class="px-2 py-2 text-xs border-r border-gray-200" x-text="formatDate(record.experimentDate)"></td>
                  <td class="px-2 py-2 text-xs border-r border-gray-300" x-text="record.reactor"></td>
                  <!-- Material columns -->
                  <td class="px-2 py-2 text-xs border-r border-gray-200" x-text="record.rawMaterial"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-300" x-text="record.startingAmount ? record.startingAmount + 'g' : ''"></td>
                  <!-- Process columns -->
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.acidAmount ? record.acidAmount + 'g' : ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.acidConcentration ? record.acidConcentration + '%' : ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.acidMolarity ? record.acidMolarity + 'M' : ''"></td>
                  <td class="px-2 py-2 text-xs border-r border-gray-200" x-text="record.acidType || ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.temperature ? record.temperature + '°C' : ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.time ? record.time + 'hr' : ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.pressureInitial ? record.pressureInitial + ' bar' : ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-300" x-text="record.pressureFinal ? record.pressureFinal + ' bar' : ''"></td>
                  <!-- Output columns -->
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.washAmount ? record.washAmount + 'g' : ''"></td>
                  <td class="px-2 py-2 text-xs border-r border-gray-200" x-text="record.washMedium || ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.dryingTemp ? record.dryingTemp + '°C' : ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.output ? record.output + 'g' : ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-300" x-text="record.kftPercentage ? record.kftPercentage + '%' : ''"></td>
                  <!-- Lot Number -->
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-300">
                    <span x-text="record.lotNumber || ''" 
                          :class="{'text-blue-600 font-semibold': record.lotNumber}"></span>
                  </td>
                  <!-- Actions -->
                  <td class="px-2 py-2 text-xs">
                    <div class="flex items-center space-x-1">
                      <template x-if="record.comments">
                        <div class="relative group">
                          <svg class="w-4 h-4 text-gray-400 hover:text-gray-600 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path>
                          </svg>
                          <div class="absolute bottom-full left-0 mb-1 hidden group-hover:block z-10 w-48 p-2 bg-gray-900 text-white text-xs rounded shadow-lg">
                            <span x-text="record.comments"></span>
                          </div>
                        </div>
                      </template>
                      <button @click="copyBiochar(record)" class="text-blue-600 hover:text-blue-900 text-xs">Copy</button>
                      <button @click="editBiochar(record)" class="text-gray-600 hover:text-gray-900 text-xs">Edit</button>
                      <button @click="deleteBiochar(record.id)" class="text-red-600 hover:text-red-900 text-xs">Delete</button>
                    </div>
                  </td>
                </tr>
                
                <!-- Expandable Related Data Row -->
                <tr x-show="expandedBiocharRows[record.experimentNumber]" 
                    x-transition:enter="transition ease-out duration-200"
                    x-transition:enter-start="opacity-0 transform scale-95"
                    x-transition:enter-end="opacity-100 transform scale-100"
                    x-transition:leave="transition ease-in duration-150"
                    x-transition:leave-start="opacity-100 transform scale-100"
                    x-transition:leave-end="opacity-0 transform scale-95"
                    class="bg-gray-50">
                  <td colspan="21" class="px-4 py-4">
                    <div x-show="loadingBiocharRelated[record.experimentNumber]" class="text-center text-gray-500">
                      Loading related data...
                    </div>
                    
                    <div x-show="!loadingBiocharRelated[record.experimentNumber] && biocharRelatedData[record.experimentNumber]" class="space-y-4">
                      
                      <!-- Direct Graphene Productions -->
                      <div x-show="biocharRelatedData[record.experimentNumber]?.directGraphene?.length > 0">
                        <h4 class="text-sm font-semibold text-gray-700 mb-2">Direct Graphene Productions</h4>
                        <div class="overflow-x-auto">
                          <table class="min-w-full text-xs border border-gray-200">
                            <thead class="bg-gray-100">
                              <tr>
                                <th class="px-2 py-1 text-left">Exp #</th>
                                <th class="px-2 py-1 text-left">Date</th>
                                <th class="px-2 py-1 text-left">Oven</th>
                                <th class="px-2 py-1 text-left">Quantity (g)</th>
                                <th class="px-2 py-1 text-left">Species</th>
                                <th class="px-2 py-1 text-left">Output (g)</th>
                              </tr>
                            </thead>
                            <tbody>
                              <template x-for="graphene in biocharRelatedData[record.experimentNumber].directGraphene" :key="graphene.id">
                                <tr class="border-t border-gray-200">
                                  <td class="px-2 py-1 font-mono" x-text="graphene.experimentNumber"></td>
                                  <td class="px-2 py-1" x-text="formatDate(graphene.experimentDate)"></td>
                                  <td class="px-2 py-1" x-text="graphene.oven"></td>
                                  <td class="px-2 py-1" x-text="graphene.quantity ? graphene.quantity + 'g' : ''"></td>
                                  <td class="px-2 py-1" x-text="graphene.species"></td>
                                  <td class="px-2 py-1" x-text="graphene.output ? graphene.output + 'g' : ''"></td>
                                </tr>
                              </template>
                            </tbody>
                          </table>
                        </div>
                      </div>

                      <!-- Lot-based Graphene Productions -->
                      <div x-show="biocharRelatedData[record.experimentNumber]?.lotGraphene?.length > 0">
                        <h4 class="text-sm font-semibold text-gray-700 mb-2">
                          Lot-based Graphene Productions 
                          <span class="text-gray-500 font-normal">(from lot: <span x-text="biocharRelatedData[record.experimentNumber].lotNumber"></span>)</span>
                        </h4>
                        <div class="overflow-x-auto">
                          <table class="min-w-full text-xs border border-gray-200">
                            <thead class="bg-gray-100">
                              <tr>
                                <th class="px-2 py-1 text-left">Exp #</th>
                                <th class="px-2 py-1 text-left">Date</th>
                                <th class="px-2 py-1 text-left">Oven</th>
                                <th class="px-2 py-1 text-left">Quantity (g)</th>
                                <th class="px-2 py-1 text-left">Species</th>
                                <th class="px-2 py-1 text-left">Output (g)</th>
                              </tr>
                            </thead>
                            <tbody>
                              <template x-for="graphene in biocharRelatedData[record.experimentNumber].lotGraphene" :key="graphene.id">
                                <tr class="border-t border-gray-200">
                                  <td class="px-2 py-1 font-mono" x-text="graphene.experimentNumber"></td>
                                  <td class="px-2 py-1" x-text="formatDate(graphene.experimentDate)"></td>
                                  <td class="px-2 py-1" x-text="graphene.oven"></td>
                                  <td class="px-2 py-1" x-text="graphene.quantity ? graphene.quantity + 'g' : ''"></td>
                                  <td class="px-2 py-1" x-text="graphene.species"></td>
                                  <td class="px-2 py-1" x-text="graphene.output ? graphene.output + 'g' : ''"></td>
                                </tr>
                              </template>
                            </tbody>
                          </table>
                        </div>
                      </div>

                      <!-- BET Tests -->
                      <div x-show="biocharRelatedData[record.experimentNumber]?.betTests?.length > 0">
                        <h4 class="text-sm font-semibold text-gray-700 mb-2">BET Surface Area Tests</h4>
                        <div class="overflow-x-auto">
                          <table class="min-w-full text-xs border border-gray-200">
                            <thead class="bg-gray-100">
                              <tr>
                                <th class="px-2 py-1 text-left">Test Date</th>
                                <th class="px-2 py-1 text-left">Graphene Sample</th>
                                <th class="px-2 py-1 text-left">BET Area (m²/g)</th>
                                <th class="px-2 py-1 text-left">Langmuir Area (m²/g)</th>
                                <th class="px-2 py-1 text-left">Species</th>
                              </tr>
                            </thead>
                            <tbody>
                              <template x-for="bet in biocharRelatedData[record.experimentNumber].betTests" :key="bet.id">
                                <tr class="border-t border-gray-200">
                                  <td class="px-2 py-1" x-text="formatDate(bet.testDate)"></td>
                                  <td class="px-2 py-1 font-mono" x-text="bet.grapheneSample"></td>
                                  <td class="px-2 py-1 font-mono" x-text="bet.multipointBetArea ? formatScientific(bet.multipointBetArea) : ''"></td>
                                  <td class="px-2 py-1 font-mono" x-text="bet.langmuirSurfaceArea ? formatScientific(bet.langmuirSurfaceArea) : ''"></td>
                                  <td class="px-2 py-1" x-text="bet.species"></td>
                                </tr>
                              </template>
                            </tbody>
                          </table>
                        </div>
                      </div>

                      <!-- No Related Data Message -->
                      <div x-show="!biocharRelatedData[record.experimentNumber]?.directGraphene?.length && 
                                   !biocharRelatedData[record.experimentNumber]?.lotGraphene?.length && 
                                   !biocharRelatedData[record.experimentNumber]?.betTests?.length" 
                           class="text-center text-gray-500 py-4">
                        No related graphene or BET data found for this biochar experiment.
                      </div>
                      
                    </div>
                  </td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Graphene Tab -->
      <div x-show="activeTab === 'graphene'" x-cloak>
        <div class="mb-6 flex justify-between items-center">
          <h2 class="text-xl font-semibold">Graphene Production Records</h2>
          <div class="flex space-x-2">
            <button @click="exportData('graphene')" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">
              Export CSV
            </button>
            <button @click="grapheneForm = {experimentNumber: '', testOrder: '', experimentDate: '', dateUnknown: false, researchTeam: 'Curia - Germany', oven: '', quantity: '', biocharExperiment: '', biocharLotNumber: '', biocharSource: '', baseAmount: '', baseType: '', baseConcentration: '', grindingMethod: '', grindingTime: '', homogeneous: '', gas: '', tempRate: '', tempMax: '', time: '', washAmount: '', washSolution: '', washConcentration: '', washWater: '', dryingTemp: '', dryingAtmosphere: '', dryingPressure: 'atm. Pressure', volumeMl: '', density: '', species: '', appearanceTags: [], semReportFile: null, output: '', comments: ''}; editingGraphene = null; showAddGraphene = true" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">
              Add Record
            </button>
          </div>
        </div>

        <!-- Search Bar -->
        <div class="mb-4">
          <input
            type="text"
            x-model="grapheneSearch"
            @input="searchGraphene()"
            placeholder="Search experiments, biochar source, species..."
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black"
          >
        </div>

        <!-- Graphene Table -->
        <div class="overflow-x-auto border border-gray-200 rounded-lg">
          <table class="min-w-full divide-y divide-gray-200">
            <thead>
              <!-- Main Header Row -->
              <tr class="bg-gray-100">
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Order</th>
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Exp #</th>
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Date</th>
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Oven</th>
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Qty (g)</th>
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Biochar</th>
                <th colspan="3" class="px-2 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Base</th>
                <th colspan="2" class="px-2 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Grinding</th>
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Homog.</th>
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Gas</th>
                <th colspan="3" class="px-2 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Temperature</th>
                <th colspan="4" class="px-2 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Wash</th>
                <th colspan="3" class="px-2 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Drying</th>
                <th colspan="4" class="px-2 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Results</th>
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Species</th>
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-r border-gray-300">Appearance</th>
                <th rowspan="2" class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Actions</th>
              </tr>
              <!-- Sub-Header Row -->
              <tr class="bg-gray-50">
                <!-- Base sub-headers -->
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Amt</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Type</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-300">Conc%</th>
                <!-- Grinding sub-headers -->
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Method</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-300">Time</th>
                <!-- Temperature sub-headers -->
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Rate</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Max</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-300">Time</th>
                <!-- Wash sub-headers -->
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Amt</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Sol.</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Conc%</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-300">Water</th>
                <!-- Drying sub-headers -->
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Temp</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Atm.</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-300">Press.</th>
                <!-- Results sub-headers -->
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Vol(ml)</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Dens.</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200">Out(g)</th>
                <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-300">Out%</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <template x-for="record in grapheneRecords" :key="record.id">
                <tr class="hover:bg-gray-50">
                  <!-- Basic info -->
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.testOrder || '-'"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200">
                    <button 
                      @click="toggleGrapheneExpansion(record.experimentNumber)" 
                      class="text-blue-600 hover:text-blue-800 underline cursor-pointer"
                      x-text="record.experimentNumber">
                    </button>
                  </td>
                  <td class="px-2 py-2 text-xs border-r border-gray-200" x-text="formatDate(record.experimentDate)"></td>
                  <td class="px-2 py-2 text-xs border-r border-gray-200" x-text="record.oven"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.quantity ? record.quantity + 'g' : ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-300">
                    <span x-text="record.biocharExperiment || (record.biocharLotNumber ? 'LOT: ' + record.biocharLotNumber : '')"
                          :class="{'text-blue-600 font-semibold': record.biocharLotNumber}"></span>
                  </td>
                  <!-- Base columns -->
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.baseAmount ? record.baseAmount + 'g' : ''"></td>
                  <td class="px-2 py-2 text-xs border-r border-gray-200" x-text="record.baseType"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-300" x-text="record.baseConcentration ? record.baseConcentration + '%' : ''"></td>
                  <!-- Grinding columns -->
                  <td class="px-2 py-2 text-xs border-r border-gray-200" x-text="record.grindingMethod"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-300" x-text="record.grindingTime ? record.grindingTime + 'min' : ''"></td>
                  <!-- Homogeneous -->
                  <td class="px-2 py-2 text-xs border-r border-gray-300" x-text="record.homogeneous !== null ? (record.homogeneous ? 'Yes' : 'No') : ''"></td>
                  <!-- Gas -->
                  <td class="px-2 py-2 text-xs border-r border-gray-300" x-text="record.gas"></td>
                  <!-- Temperature columns -->
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.tempRate ? record.tempRate + '°C/min' : ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.tempMax ? record.tempMax + '°C' : ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-300" x-text="record.time ? record.time + 'hr' : ''"></td>
                  <!-- Wash columns -->
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.washAmount ? record.washAmount + 'g' : ''"></td>
                  <td class="px-2 py-2 text-xs border-r border-gray-200" x-text="record.washSolution"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.washConcentration ? record.washConcentration + '%' : ''"></td>
                  <td class="px-2 py-2 text-xs border-r border-gray-300" x-text="record.washWater"></td>
                  <!-- Drying columns -->
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.dryingTemp ? record.dryingTemp + '°C' : ''"></td>
                  <td class="px-2 py-2 text-xs border-r border-gray-200" x-text="record.dryingAtmosphere"></td>
                  <td class="px-2 py-2 text-xs border-r border-gray-300" x-text="record.dryingPressure"></td>
                  <!-- Results columns -->
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.volumeMl ? record.volumeMl + 'ml' : ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.density || ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-200" x-text="record.output ? record.output + 'g' : ''"></td>
                  <td class="px-2 py-2 text-xs font-mono border-r border-gray-300" x-text="calculateOutputPercentage(record)"></td>
                  <!-- Species & Appearance -->
                  <td class="px-2 py-2 text-xs border-r border-gray-300" x-text="record.species"></td>
                  <td class="px-2 py-2 text-xs border-r border-gray-300" x-text="formatAppearanceTags(record.appearanceTags)"></td>
                  <!-- Actions -->
                  <td class="px-2 py-2 text-xs">
                    <div class="flex items-center space-x-1">
                      <template x-if="record.comments">
                        <div class="relative group">
                          <svg class="w-4 h-4 text-gray-400 hover:text-gray-600 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path>
                          </svg>
                          <div class="absolute bottom-full left-0 mb-1 hidden group-hover:block z-10 w-48 p-2 bg-gray-900 text-white text-xs rounded shadow-lg">
                            <span x-text="record.comments"></span>
                          </div>
                        </div>
                      </template>
                      <button x-show="record.semReportPath" @click="viewSemReport(record.semReportPath)" class="text-blue-600 hover:text-blue-900 text-xs mr-2">View SEM</button>
                      <button @click="editGraphene(record)" class="text-gray-600 hover:text-gray-900 text-xs">Edit</button>
                      <button @click="deleteGraphene(record.id)" class="text-red-600 hover:text-red-900 text-xs">Delete</button>
                    </div>
                  </td>
                </tr>
                
                <!-- Expandable Related Data Row -->
                <tr x-show="expandedGrapheneRows[record.experimentNumber]" 
                    x-transition:enter="transition ease-out duration-200"
                    x-transition:enter-start="opacity-0 transform scale-95"
                    x-transition:enter-end="opacity-100 transform scale-100"
                    x-transition:leave="transition ease-in duration-150"
                    x-transition:leave-start="opacity-100 transform scale-100"
                    x-transition:leave-end="opacity-0 transform scale-95"
                    class="bg-gray-50">
                  <td colspan="28" class="px-4 py-4">
                    <div x-show="loadingGrapheneRelated[record.experimentNumber]" class="text-center text-gray-500">
                      Loading related data...
                    </div>
                    
                    <div x-show="!loadingGrapheneRelated[record.experimentNumber] && grapheneRelatedData[record.experimentNumber]" class="space-y-4">
                      
                      <!-- Source Biochar (Direct Reference) -->
                      <div x-show="grapheneRelatedData[record.experimentNumber]?.sourceBiochar">
                        <h4 class="text-sm font-semibold text-gray-700 mb-2">Source Biochar</h4>
                        <div class="overflow-x-auto">
                          <table class="min-w-full text-xs border border-gray-200">
                            <thead class="bg-gray-100">
                              <tr>
                                <th class="px-2 py-1 text-left">Exp #</th>
                                <th class="px-2 py-1 text-left">Date</th>
                                <th class="px-2 py-1 text-left">Raw Material</th>
                                <th class="px-2 py-1 text-left">Start (g)</th>
                                <th class="px-2 py-1 text-left">Temp (°C)</th>
                                <th class="px-2 py-1 text-left">Time (hr)</th>
                                <th class="px-2 py-1 text-left">Output (g)</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr class="border-t border-gray-200">
                                <td class="px-2 py-1 font-mono" x-text="grapheneRelatedData[record.experimentNumber].sourceBiochar.experimentNumber"></td>
                                <td class="px-2 py-1" x-text="formatDate(grapheneRelatedData[record.experimentNumber].sourceBiochar.experimentDate)"></td>
                                <td class="px-2 py-1" x-text="grapheneRelatedData[record.experimentNumber].sourceBiochar.rawMaterial"></td>
                                <td class="px-2 py-1" x-text="grapheneRelatedData[record.experimentNumber].sourceBiochar.startingAmount ? grapheneRelatedData[record.experimentNumber].sourceBiochar.startingAmount + 'g' : ''"></td>
                                <td class="px-2 py-1" x-text="grapheneRelatedData[record.experimentNumber].sourceBiochar.temperature ? grapheneRelatedData[record.experimentNumber].sourceBiochar.temperature + '°C' : ''"></td>
                                <td class="px-2 py-1" x-text="grapheneRelatedData[record.experimentNumber].sourceBiochar.time ? grapheneRelatedData[record.experimentNumber].sourceBiochar.time + 'hr' : ''"></td>
                                <td class="px-2 py-1" x-text="grapheneRelatedData[record.experimentNumber].sourceBiochar.output ? grapheneRelatedData[record.experimentNumber].sourceBiochar.output + 'g' : ''"></td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>

                      <!-- Source Biochar Lot Experiments -->
                      <div x-show="grapheneRelatedData[record.experimentNumber]?.lotBiocharExperiments?.length > 0">
                        <h4 class="text-sm font-semibold text-gray-700 mb-2">
                          Source Biochar Lot Experiments
                          <span class="text-gray-500 font-normal" x-show="grapheneRelatedData[record.experimentNumber]?.lotInfo">
                            (from lot: <span x-text="grapheneRelatedData[record.experimentNumber].lotInfo.lotNumber"></span>)
                          </span>
                        </h4>
                        <div class="overflow-x-auto">
                          <table class="min-w-full text-xs border border-gray-200">
                            <thead class="bg-gray-100">
                              <tr>
                                <th class="px-2 py-1 text-left">Exp #</th>
                                <th class="px-2 py-1 text-left">Date</th>
                                <th class="px-2 py-1 text-left">Raw Material</th>
                                <th class="px-2 py-1 text-left">Start (g)</th>
                                <th class="px-2 py-1 text-left">Temp (°C)</th>
                                <th class="px-2 py-1 text-left">Time (hr)</th>
                                <th class="px-2 py-1 text-left">Output (g)</th>
                              </tr>
                            </thead>
                            <tbody>
                              <template x-for="biochar in grapheneRelatedData[record.experimentNumber].lotBiocharExperiments" :key="biochar.id">
                                <tr class="border-t border-gray-200">
                                  <td class="px-2 py-1 font-mono" x-text="biochar.experimentNumber"></td>
                                  <td class="px-2 py-1" x-text="formatDate(biochar.experimentDate)"></td>
                                  <td class="px-2 py-1" x-text="biochar.rawMaterial"></td>
                                  <td class="px-2 py-1" x-text="biochar.startingAmount ? biochar.startingAmount + 'g' : ''"></td>
                                  <td class="px-2 py-1" x-text="biochar.temperature ? biochar.temperature + '°C' : ''"></td>
                                  <td class="px-2 py-1" x-text="biochar.time ? biochar.time + 'hr' : ''"></td>
                                  <td class="px-2 py-1" x-text="biochar.output ? biochar.output + 'g' : ''"></td>
                                </tr>
                              </template>
                            </tbody>
                          </table>
                        </div>
                      </div>

                      <!-- BET Tests -->
                      <div x-show="grapheneRelatedData[record.experimentNumber]?.betTests?.length > 0">
                        <h4 class="text-sm font-semibold text-gray-700 mb-2">BET Surface Area Tests</h4>
                        <div class="overflow-x-auto">
                          <table class="min-w-full text-xs border border-gray-200">
                            <thead class="bg-gray-100">
                              <tr>
                                <th class="px-2 py-1 text-left">Test Date</th>
                                <th class="px-2 py-1 text-left">BET Area (m²/g)</th>
                                <th class="px-2 py-1 text-left">Langmuir Area (m²/g)</th>
                                <th class="px-2 py-1 text-left">Species</th>
                              </tr>
                            </thead>
                            <tbody>
                              <template x-for="bet in grapheneRelatedData[record.experimentNumber].betTests" :key="bet.id">
                                <tr class="border-t border-gray-200">
                                  <td class="px-2 py-1" x-text="formatDate(bet.testDate)"></td>
                                  <td class="px-2 py-1 font-mono" x-text="bet.multipointBetArea ? formatScientific(bet.multipointBetArea) : ''"></td>
                                  <td class="px-2 py-1 font-mono" x-text="bet.langmuirSurfaceArea ? formatScientific(bet.langmuirSurfaceArea) : ''"></td>
                                  <td class="px-2 py-1" x-text="bet.species"></td>
                                </tr>
                              </template>
                            </tbody>
                          </table>
                        </div>
                      </div>

                      <!-- No Related Data Message -->
                      <div x-show="!grapheneRelatedData[record.experimentNumber]?.sourceBiochar && 
                                   !grapheneRelatedData[record.experimentNumber]?.lotBiocharExperiments?.length && 
                                   !grapheneRelatedData[record.experimentNumber]?.betTests?.length" 
                           class="text-center text-gray-500 py-4">
                        No related biochar or BET data found for this graphene experiment.
                      </div>
                      
                    </div>
                  </td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </div>

      <!-- BET Tab -->
      <div x-show="activeTab === 'bet'" x-cloak>
        <div class="mb-6 flex justify-between items-center">
          <h2 class="text-xl font-semibold">BET Surface Area Analysis</h2>
          <div class="flex space-x-2">
            <button @click="exportData('bet')" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">
              Export CSV
            </button>
            <button @click="betForm = {sampleNumber: '', testOrder: '', testDate: '', dateUnknown: false, grapheneSample: '', multipointBetArea: '', langmuirSurfaceArea: '', species: '', comments: ''}; editingBet = null; showAddBet = true" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">
              Add Record
            </button>
          </div>
        </div>

        <!-- Search Bar -->
        <div class="mb-4">
          <input
            type="text"
            x-model="betSearch"
            @input="searchBet()"
            placeholder="Search samples, graphene batches..."
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black"
          >
        </div>

        <!-- BET Table -->
        <div class="overflow-x-auto border border-gray-200 rounded-lg">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Graphene Sample</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Multipoint BET Area (m²/g)</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Langmuir Surface Area (m²/g)</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Species</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <template x-for="record in betRecords" :key="record.id">
                <tr class="hover:bg-gray-50">
                  <td class="px-4 py-3 text-sm" x-text="formatDate(record.testDate)"></td>
                  <td class="px-4 py-3 text-sm font-mono" x-text="record.grapheneSample"></td>
                  <td class="px-4 py-3 text-sm font-mono" x-text="formatScientificNotation(record.multipointBetArea)"></td>
                  <td class="px-4 py-3 text-sm font-mono" x-text="formatScientificNotation(record.langmuirSurfaceArea)"></td>
                  <td class="px-4 py-3 text-sm" x-text="record.species"></td>
                  <td class="px-4 py-3 text-sm">
                    <div class="flex items-center space-x-2">
                      <template x-if="record.comments">
                        <div class="relative group">
                          <svg class="w-4 h-4 text-gray-400 hover:text-gray-600 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path>
                          </svg>
                          <div class="absolute bottom-full left-0 mb-1 hidden group-hover:block z-10 w-64 p-2 bg-gray-900 text-white text-xs rounded shadow-lg">
                            <span x-text="record.comments"></span>
                          </div>
                        </div>
                      </template>
                      <button @click="editBet(record)" class="text-gray-600 hover:text-gray-900">Edit</button>
                      <button @click="deleteBet(record.id)" class="text-red-600 hover:text-red-900">Delete</button>
                    </div>
                  </td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </div>
    </main>

    <!-- Biochar Add/Edit Modal -->
    <div x-show="showAddBiochar" x-cloak
         @click.away="showAddBiochar = false; editingBiochar = null"
         class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto p-6">
          <h3 class="text-lg font-semibold mb-4" x-text="editingBiochar ? 'Edit Biochar Record' : 'Add Biochar Record'"></h3>
          
          <form @submit.prevent="saveBiochar()" class="space-y-6">
            <!-- Basic Information -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Basic Information</h4>
              <div class="grid grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Experiment #</label>
                  <input type="text" x-model="biocharForm.experimentNumber" required
                         class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Test Order</label>
                  <input type="number" x-model="biocharForm.testOrder" 
                         placeholder="1, 2, 3..."
                         class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Experiment Date</label>
                  <div class="flex items-center space-x-2">
                    <input type="date" x-model="biocharForm.experimentDate" 
                           :disabled="biocharForm.dateUnknown"
                           class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black disabled:bg-gray-100">
                    <label class="flex items-center whitespace-nowrap">
                      <input type="checkbox" x-model="biocharForm.dateUnknown" 
                             @change="if($event.target.checked) biocharForm.experimentDate = ''"
                             class="mr-2 rounded border-gray-300">
                      <span class="text-sm">Unknown</span>
                    </label>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Research Team</label>
                  <div class="relative">
                    <select x-model="biocharForm.researchTeam" 
                            @change="if($event.target.value === 'add_new') { showAddResearchTeam = true; biocharForm.researchTeam = 'Curia - Germany'; }"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black appearance-none">
                      <option value="">Select team...</option>
                      <template x-for="team in researchTeams" :key="team">
                        <option :value="team" x-text="team"></option>
                      </template>
                      <option value="add_new" class="font-semibold">+ Add New Team</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Setup & Materials -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Setup & Materials</h4>
              <div class="grid grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Reactor</label>
                  <div class="relative">
                    <select x-model="biocharForm.reactor" 
                            @change="if($event.target.value === 'add_new') { showAddReactor = true; biocharForm.reactor = ''; }"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black appearance-none">
                      <option value="">Select reactor...</option>
                      <template x-for="reactor in reactors" :key="reactor">
                        <option :value="reactor" x-text="reactor"></option>
                      </template>
                      <option value="add_new" class="font-semibold">+ Add New Reactor</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Raw Material</label>
                  <div class="relative">
                    <select x-model="biocharForm.rawMaterial" 
                            @change="if($event.target.value === 'add_new') { showAddMaterial = true; biocharForm.rawMaterial = ''; }"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black appearance-none">
                      <option value="">Select material...</option>
                      <template x-for="material in rawMaterials" :key="material">
                        <option :value="material" x-text="material"></option>
                      </template>
                      <option value="add_new" class="font-semibold">+ Add New Material</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Starting Amount (g)</label>
                  <input type="number" step="0.01" x-model="biocharForm.startingAmount"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
                </div>
              </div>
            </div>
            
            <!-- Acid Treatment -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Acid Treatment</h4>
              <div class="grid grid-cols-4 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Amount (g)</label>
                  <input type="number" step="0.01" x-model="biocharForm.acidAmount"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Concentration (%)</label>
                  <input type="number" step="0.01" x-model="biocharForm.acidConcentration"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Molarity (M)</label>
                  <input type="number" step="0.01" x-model="biocharForm.acidMolarity"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                  <div class="relative">
                    <select x-model="biocharForm.acidType" 
                            @change="if($event.target.value === 'add_new') { showAddAcidType = true; biocharForm.acidType = ''; }"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md appearance-none">
                      <option value="">Select...</option>
                      <template x-for="acid in acidTypes" :key="acid">
                        <option :value="acid" x-text="acid"></option>
                      </template>
                      <option value="add_new" class="font-semibold">+ Add New</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Process Conditions -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Process Conditions</h4>
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Temperature (°C)</label>
                  <input type="number" step="0.1" x-model="biocharForm.temperature"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Time (hr)</label>
                  <input type="number" step="0.1" x-model="biocharForm.time"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Initial Pressure (bar)</label>
                  <input type="number" step="0.1" x-model="biocharForm.pressureInitial"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Final Pressure (bar)</label>
                  <input type="number" step="0.1" x-model="biocharForm.pressureFinal"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
              </div>
            </div>
            
            <!-- Post-Processing -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Post-Processing</h4>
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Wash Amount (g)</label>
                  <input type="number" step="0.01" x-model="biocharForm.washAmount"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Wash Medium</label>
                  <div class="relative">
                    <select x-model="biocharForm.washMedium" 
                            @change="if($event.target.value === 'add_new') { showAddWashMedium = true; biocharForm.washMedium = ''; }"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md appearance-none">
                      <option value="">Select medium...</option>
                      <template x-for="medium in washMediums" :key="medium">
                        <option :value="medium" x-text="medium"></option>
                      </template>
                      <option value="add_new" class="font-semibold">+ Add New Medium</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
              <div class="grid grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Drying Temp (°C)</label>
                  <input type="number" step="0.1" x-model="biocharForm.dryingTemp"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">KFT (%)</label>
                  <input type="number" step="0.01" x-model="biocharForm.kftPercentage"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Output (g)</label>
                  <input type="number" step="0.01" x-model="biocharForm.output"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
              </div>
            </div>
            
            <!-- Comments -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Comments</label>
              <textarea x-model="biocharForm.comments" rows="2"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md"></textarea>
            </div>
            
            <div class="flex justify-end space-x-2 pt-4">
              <button type="button" @click="showAddBiochar = false; editingBiochar = null; biocharForm = {}"
                      class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">
                Cancel
              </button>
              <button type="submit"
                      class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">
                Save
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Graphene Add/Edit Modal -->
    <div x-show="showAddGraphene" x-cloak
         @click.away="showAddGraphene = false; editingGraphene = null"
         class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto p-6">
          <h3 class="text-lg font-semibold mb-4" x-text="editingGraphene ? 'Edit Graphene Record' : 'Add Graphene Record'"></h3>
          
          <form @submit.prevent="saveGraphene()" class="space-y-6">
            <!-- Basic Information -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Basic Information</h4>
              <div class="grid grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Experiment #</label>
                  <input type="text" x-model="grapheneForm.experimentNumber" required
                         class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Test Order</label>
                  <input type="number" x-model="grapheneForm.testOrder" 
                         placeholder="1, 2, 3..."
                         class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Experiment Date</label>
                  <div class="flex items-center space-x-2">
                    <input type="date" x-model="grapheneForm.experimentDate" 
                           :disabled="grapheneForm.dateUnknown"
                           class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black disabled:bg-gray-100">
                    <label class="flex items-center whitespace-nowrap">
                      <input type="checkbox" x-model="grapheneForm.dateUnknown" 
                             @change="if($event.target.checked) grapheneForm.experimentDate = ''"
                             class="mr-2 rounded border-gray-300">
                      <span class="text-sm">Unknown</span>
                    </label>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Research Team</label>
                  <div class="relative">
                    <select x-model="grapheneForm.researchTeam" 
                            @change="if($event.target.value === 'add_new') { showAddResearchTeam = true; grapheneForm.researchTeam = 'Curia - Germany'; }"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black appearance-none">
                      <option value="">Select team...</option>
                      <template x-for="team in researchTeams" :key="team">
                        <option :value="team" x-text="team"></option>
                      </template>
                      <option value="add_new" class="font-semibold">+ Add New Team</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Setup & Materials -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Setup & Materials</h4>
              <div class="grid grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Oven</label>
                  <div class="relative">
                    <select x-model="grapheneForm.oven" 
                            @change="if($event.target.value === 'add_new') { showAddOven = true; grapheneForm.oven = ''; }"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black appearance-none">
                      <option value="">Select oven...</option>
                      <template x-for="oven in ovens" :key="oven">
                        <option :value="oven" x-text="oven"></option>
                      </template>
                      <option value="add_new" class="font-semibold">+ Add New Oven</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Quantity (g)</label>
                  <input type="number" step="0.01" x-model="grapheneForm.quantity"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Biochar Source</label>
                  <div class="relative">
                    <select x-model="grapheneForm.biocharSource" 
                            @change="handleBiocharSourceChange($event)"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black appearance-none">
                      <option value="">Select biochar source...</option>
                      <optgroup label="Individual Experiments">
                        <template x-for="exp in availableExperiments" :key="'exp-' + exp">
                          <option :value="'exp:' + exp" x-text="'EXP: ' + exp"></option>
                        </template>
                      </optgroup>
                      <optgroup label="Combined Lots" x-show="availableLots.length > 0">
                        <template x-for="lot in availableLots" :key="'lot-' + lot.lotNumber">
                          <option :value="'lot:' + lot.lotNumber" x-text="'LOT: ' + lot.lotNumber + (lot.lotName ? ' (' + lot.lotName + ')' : '') + ' - ' + lot._count.experiments + ' experiments'"></option>
                        </template>
                      </optgroup>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </div>
                  <p class="text-xs text-gray-500 mt-1">Select individual experiment or combined lot</p>
                </div>
              </div>
            </div>
            
            <!-- Base Treatment -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Base Treatment</h4>
              <div class="grid grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Amount (g)</label>
                  <input type="number" step="0.01" x-model="grapheneForm.baseAmount"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                  <div class="relative">
                    <select x-model="grapheneForm.baseType" 
                            @change="if($event.target.value === 'add_new') { showAddBaseType = true; grapheneForm.baseType = ''; }"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md appearance-none">
                      <option value="">Select...</option>
                      <template x-for="base in baseTypes" :key="base">
                        <option :value="base" x-text="base"></option>
                      </template>
                      <option value="add_new" class="font-semibold">+ Add New</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Concentration (%)</label>
                  <input type="number" step="0.01" x-model="grapheneForm.baseConcentration"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
              </div>
            </div>

            <!-- Preparation -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Preparation</h4>
              <div class="grid grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Grinding Method</label>
                  <select x-model="grapheneForm.grindingMethod"
                          class="w-full px-3 py-2 border border-gray-300 rounded-md">
                    <option value="">Select...</option>
                    <option value="manual">Manual</option>
                    <option value="mill">Mill</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Grinding Time (min)</label>
                  <input type="number" step="0.1" x-model="grapheneForm.grindingTime"
                         :disabled="grapheneForm.grindingMethod !== 'mill'"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md disabled:bg-gray-100">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Homogeneous</label>
                  <select x-model="grapheneForm.homogeneous"
                          class="w-full px-3 py-2 border border-gray-300 rounded-md">
                    <option value="">Select...</option>
                    <option value="true">Yes</option>
                    <option value="false">No</option>
                  </select>
                </div>
              </div>
            </div>
            
            <!-- Thermal Treatment -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Thermal Treatment</h4>
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Gas</label>
                  <div class="relative">
                    <select x-model="grapheneForm.gas" 
                            @change="if($event.target.value === 'add_new') { showAddGas = true; grapheneForm.gas = ''; }"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md appearance-none">
                      <option value="">Select gas...</option>
                      <template x-for="gas in gases" :key="gas">
                        <option :value="gas" x-text="gas"></option>
                      </template>
                      <option value="add_new" class="font-semibold">+ Add New Gas</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Time (hr)</label>
                  <input type="number" step="0.1" x-model="grapheneForm.time"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Temperature Rate (°C/min)</label>
                  <input type="number" step="0.1" x-model="grapheneForm.tempRate" placeholder="3"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Max Temperature (°C)</label>
                  <input type="number" step="0.1" x-model="grapheneForm.tempMax"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
              </div>
            </div>
            
            <!-- Washing -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Washing</h4>
              <div class="grid grid-cols-4 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Amount (g)</label>
                  <input type="number" step="0.01" x-model="grapheneForm.washAmount"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Solution</label>
                  <div class="relative">
                    <select x-model="grapheneForm.washSolution" 
                            @change="if($event.target.value === 'add_new') { showAddWashSolution = true; grapheneForm.washSolution = ''; }"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md appearance-none">
                      <option value="">Select...</option>
                      <template x-for="solution in washSolutions" :key="solution">
                        <option :value="solution" x-text="solution"></option>
                      </template>
                      <option value="add_new" class="font-semibold">+ Add New</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Concentration (%)</label>
                  <input type="number" step="0.1" x-model="grapheneForm.washConcentration"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Water</label>
                  <div class="relative">
                    <select x-model="grapheneForm.washWater"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md appearance-none">
                      <option value="">None</option>
                      <template x-for="water in washWaters" :key="water">
                        <option :value="water" x-text="water"></option>
                      </template>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Drying -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Drying</h4>
              <div class="grid grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Temperature (°C)</label>
                  <input type="number" step="0.1" x-model="grapheneForm.dryingTemp"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Atmosphere</label>
                  <div class="relative">
                    <select x-model="grapheneForm.dryingAtmosphere" 
                            @change="if($event.target.value === 'add_new') { showAddDryingAtmosphere = true; grapheneForm.dryingAtmosphere = ''; }"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md appearance-none">
                      <option value="">Select...</option>
                      <template x-for="atmosphere in dryingAtmospheres" :key="atmosphere">
                        <option :value="atmosphere" x-text="atmosphere"></option>
                      </template>
                      <option value="add_new" class="font-semibold">+ Add New</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Pressure</label>
                  <div class="relative">
                    <select x-model="grapheneForm.dryingPressure" 
                            @change="if($event.target.value === 'add_new') { showAddDryingPressure = true; grapheneForm.dryingPressure = ''; }"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md appearance-none">
                      <template x-for="pressure in dryingPressures" :key="pressure">
                        <option :value="pressure" x-text="pressure"></option>
                      </template>
                      <option value="add_new" class="font-semibold">+ Add New</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Product Characterization -->
            <div>
              <h4 class="text-sm font-medium text-gray-700 mb-3">Product Characterization</h4>
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Volume (ml)</label>
                  <input type="number" step="0.01" x-model="grapheneForm.volumeMl"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Density (ml/g)</label>
                  <input type="number" step="0.0001" x-model="grapheneForm.density"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
              </div>
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Species</label>
                  <div class="relative">
                    <select x-model="grapheneForm.species" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black appearance-none">
                      <option value="">Select species...</option>
                      <template x-for="spec in species" :key="spec">
                        <option :value="spec" x-text="spec"></option>
                      </template>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                      <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Output (g)</label>
                  <input type="number" step="0.01" x-model="grapheneForm.output"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Appearance Tags</label>
                <div class="space-y-2">
                  <div class="flex flex-wrap gap-2">
                    <template x-for="tag in appearanceTags" :key="tag">
                      <button type="button" 
                              @click="toggleAppearanceTag(tag)"
                              :class="grapheneForm.appearanceTags.includes(tag) ? 'bg-gray-900 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                              class="px-3 py-1 text-sm rounded-full border transition-colors">
                        <span x-text="tag"></span>
                      </button>
                    </template>
                  </div>
                  <div class="flex items-center space-x-2">
                    <button type="button" @click="showAddAppearanceTag = true" 
                            class="px-3 py-1 text-sm bg-blue-50 text-blue-700 rounded-full border border-blue-200 hover:bg-blue-100">
                      + Add New Tag
                    </button>
                  </div>
                  <div x-show="grapheneForm.appearanceTags.length > 0" class="text-sm text-gray-600">
                    Selected: <span x-text="(grapheneForm.appearanceTags || []).join(', ')"></span>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- SEM Report Upload -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">SEM Report (PDF)</label>
              <input type="file" 
                     accept=".pdf"
                     @change="handleSemFileChange($event)"
                     class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
              <p class="text-xs text-gray-500 mt-1">Upload PDF files only (max 10MB)</p>
              <div x-show="grapheneForm.semReportFile" class="text-sm text-green-600 mt-1">
                File selected: <span x-text="grapheneForm.semReportFile?.name"></span>
              </div>
            </div>
            
            <!-- Comments -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Comments</label>
              <textarea x-model="grapheneForm.comments" rows="2"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md"></textarea>
            </div>
            
            <div class="flex justify-end space-x-2 pt-4">
              <button type="button" @click="showAddGraphene = false; editingGraphene = null; grapheneForm = {}"
                      class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">
                Cancel
              </button>
              <button type="submit"
                      class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">
                Save
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- Add New Material Modal -->
    <div x-show="showAddMaterial" x-cloak
         @click.away="showAddMaterial = false; newMaterial = ''"
         class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-md w-full p-6">
          <h3 class="text-lg font-semibold mb-4">Add New Raw Material</h3>
          
          <form @submit.prevent="addNewMaterial()">
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-1">Material Name</label>
              <input type="text" x-model="newMaterial" required
                     class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black"
                     placeholder="Enter material name...">
            </div>
            
            <div class="flex justify-end space-x-2">
              <button type="button" @click="showAddMaterial = false; newMaterial = ''"
                      class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">
                Cancel
              </button>
              <button type="submit"
                      class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">
                Add Material
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- Add New Acid Type Modal -->
    <div x-show="showAddAcidType" x-cloak @click.away="showAddAcidType = false; newAcidType = ''" class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-md w-full p-6">
          <h3 class="text-lg font-semibold mb-4">Add New Acid Type</h3>
          <form @submit.prevent="addNewAcidType()">
            <input type="text" x-model="newAcidType" required placeholder="Enter acid type..." class="w-full px-3 py-2 border border-gray-300 rounded-md mb-4">
            <div class="flex justify-end space-x-2">
              <button type="button" @click="showAddAcidType = false; newAcidType = ''" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">Cancel</button>
              <button type="submit" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">Add</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- Add New Wash Medium Modal -->
    <div x-show="showAddWashMedium" x-cloak @click.away="showAddWashMedium = false; newWashMedium = ''" class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-md w-full p-6">
          <h3 class="text-lg font-semibold mb-4">Add New Wash Medium</h3>
          <form @submit.prevent="addNewWashMedium()">
            <input type="text" x-model="newWashMedium" required placeholder="Enter wash medium..." class="w-full px-3 py-2 border border-gray-300 rounded-md mb-4">
            <div class="flex justify-end space-x-2">
              <button type="button" @click="showAddWashMedium = false; newWashMedium = ''" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">Cancel</button>
              <button type="submit" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">Add</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- Add New Reactor Modal -->
    <div x-show="showAddReactor" x-cloak @click.away="showAddReactor = false; newReactor = ''" class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-md w-full p-6">
          <h3 class="text-lg font-semibold mb-4">Add New Reactor</h3>
          <form @submit.prevent="addNewReactor()">
            <input type="text" x-model="newReactor" required placeholder="Enter reactor name..." class="w-full px-3 py-2 border border-gray-300 rounded-md mb-4">
            <div class="flex justify-end space-x-2">
              <button type="button" @click="showAddReactor = false; newReactor = ''" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">Cancel</button>
              <button type="submit" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">Add</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- Add New Base Type Modal -->
    <div x-show="showAddBaseType" x-cloak @click.away="showAddBaseType = false; newBaseType = ''" class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-md w-full p-6">
          <h3 class="text-lg font-semibold mb-4">Add New Base Type</h3>
          <form @submit.prevent="addNewBaseType()">
            <input type="text" x-model="newBaseType" required placeholder="Enter base type..." class="w-full px-3 py-2 border border-gray-300 rounded-md mb-4">
            <div class="flex justify-end space-x-2">
              <button type="button" @click="showAddBaseType = false; newBaseType = ''" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">Cancel</button>
              <button type="submit" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">Add</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- Add New Gas Modal -->
    <div x-show="showAddGas" x-cloak @click.away="showAddGas = false; newGas = ''" class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-md w-full p-6">
          <h3 class="text-lg font-semibold mb-4">Add New Gas</h3>
          <form @submit.prevent="addNewGas()">
            <input type="text" x-model="newGas" required placeholder="Enter gas type..." class="w-full px-3 py-2 border border-gray-300 rounded-md mb-4">
            <div class="flex justify-end space-x-2">
              <button type="button" @click="showAddGas = false; newGas = ''" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">Cancel</button>
              <button type="submit" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">Add</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- Add New Wash Solution Modal -->
    <div x-show="showAddWashSolution" x-cloak @click.away="showAddWashSolution = false; newWashSolution = ''" class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-md w-full p-6">
          <h3 class="text-lg font-semibold mb-4">Add New Wash Solution</h3>
          <form @submit.prevent="addNewWashSolution()">
            <input type="text" x-model="newWashSolution" required placeholder="Enter wash solution..." class="w-full px-3 py-2 border border-gray-300 rounded-md mb-4">
            <div class="flex justify-end space-x-2">
              <button type="button" @click="showAddWashSolution = false; newWashSolution = ''" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">Cancel</button>
              <button type="submit" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">Add</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- Add New Drying Atmosphere Modal -->
    <div x-show="showAddDryingAtmosphere" x-cloak @click.away="showAddDryingAtmosphere = false; newDryingAtmosphere = ''" class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-md w-full p-6">
          <h3 class="text-lg font-semibold mb-4">Add New Drying Atmosphere</h3>
          <form @submit.prevent="addNewDryingAtmosphere()">
            <input type="text" x-model="newDryingAtmosphere" required placeholder="Enter atmosphere..." class="w-full px-3 py-2 border border-gray-300 rounded-md mb-4">
            <div class="flex justify-end space-x-2">
              <button type="button" @click="showAddDryingAtmosphere = false; newDryingAtmosphere = ''" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">Cancel</button>
              <button type="submit" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">Add</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- Add New Oven Modal -->
    <div x-show="showAddOven" x-cloak @click.away="showAddOven = false; newOven = ''" class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-md w-full p-6">
          <h3 class="text-lg font-semibold mb-4">Add New Oven</h3>
          <form @submit.prevent="addNewOven()">
            <input type="text" x-model="newOven" required placeholder="Enter oven identifier..." class="w-full px-3 py-2 border border-gray-300 rounded-md mb-4">
            <div class="flex justify-end space-x-2">
              <button type="button" @click="showAddOven = false; newOven = ''" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">Cancel</button>
              <button type="submit" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">Add</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Add New Drying Pressure Modal -->
    <div x-show="showAddDryingPressure" x-cloak @click.away="showAddDryingPressure = false; newDryingPressure = ''" class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-md w-full p-6">
          <h3 class="text-lg font-semibold mb-4">Add New Drying Pressure</h3>
          <form @submit.prevent="addNewDryingPressure()">
            <input type="text" x-model="newDryingPressure" placeholder="Enter drying pressure..." 
                   class="w-full px-3 py-2 border border-gray-300 rounded-md mb-4" autofocus>
            <div class="flex justify-end space-x-2">
              <button type="button" @click="showAddDryingPressure = false; newDryingPressure = ''" class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">Cancel</button>
              <button type="submit" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">Add</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Add New Appearance Tag Modal -->
    <div x-show="showAddAppearanceTag" x-cloak @click.away="showAddAppearanceTag = false; newAppearanceTag = ''" class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-md w-full p-6">
          <h3 class="text-lg font-semibold mb-4">Add New Appearance Tag</h3>
          <form @submit.prevent="addNewAppearanceTag()">
            <input type="text" x-model="newAppearanceTag" placeholder="Enter appearance tag..." 
                   class="w-full px-3 py-2 border border-gray-300 rounded-md mb-4" autofocus>
            <div class="flex justify-end space-x-2">
              <button type="button" @click="showAddAppearanceTag = false; newAppearanceTag = ''" 
                      class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">Cancel</button>
              <button type="submit" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">Add Tag</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Combine Biochar into Lot Modal -->
    <div x-show="showCombineModal" x-cloak
         @click.away="showCombineModal = false; selectedBiocharIds = []; combineForm = {lotNumber: '', lotName: '', description: ''}"
         class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6">
          <h3 class="text-lg font-semibold mb-4">Combine Biochar Experiments into Lot</h3>
          
          <form @submit.prevent="combineBiocharIntoLot()" class="space-y-4">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Lot Number *</label>
                <input type="text" x-model="combineForm.lotNumber" required
                       placeholder="LOT-001"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Lot Name</label>
                <input type="text" x-model="combineForm.lotName"
                       placeholder="High Temperature Batch"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
              </div>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
              <textarea x-model="combineForm.description" rows="3"
                        placeholder="Combined experiments with similar parameters..."
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black"></textarea>
            </div>
            
            <div>
              <h4 class="font-medium text-gray-700 mb-2">Selected Experiments (<span x-text="selectedBiocharIds.length"></span>)</h4>
              <div class="max-h-48 overflow-y-auto border border-gray-200 rounded-md">
                <template x-for="id in selectedBiocharIds" :key="id">
                  <div class="px-3 py-2 border-b border-gray-100 text-sm">
                    <span x-text="biocharRecords.find(r => r.id === id)?.experimentNumber"></span>
                    <span class="text-gray-500 ml-2" x-text="'- ' + formatDate(biocharRecords.find(r => r.id === id)?.experimentDate)"></span>
                  </div>
                </template>
                <div x-show="selectedBiocharIds.length === 0" class="px-3 py-4 text-sm text-gray-500 text-center">
                  No experiments selected. Please select experiments from the table above.
                </div>
              </div>
            </div>
            
            <div class="flex justify-end space-x-3">
              <button type="button" @click="showCombineModal = false; selectedBiocharIds = []; combineForm = {lotNumber: '', lotName: '', description: ''}" 
                      class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">
                Cancel
              </button>
              <button type="submit" 
                      :disabled="selectedBiocharIds.length === 0 || !combineForm.lotNumber"
                      :class="{'opacity-50 cursor-not-allowed': selectedBiocharIds.length === 0 || !combineForm.lotNumber}"
                      class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">
                Create Lot
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- BET Add/Edit Modal -->
    <div x-show="showAddBet" x-cloak
         @click.away="showAddBet = false; editingBet = null"
         class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6">
          <h3 class="text-lg font-semibold mb-4" x-text="editingBet ? 'Edit BET Record' : 'Add BET Record'"></h3>
          
          <form @submit.prevent="saveBet()" class="space-y-4">
            <div class="grid grid-cols-1 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Test Date</label>
                <div class="flex items-center space-x-2">
                  <input type="date" x-model="betForm.testDate" 
                         :disabled="betForm.dateUnknown"
                         class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black disabled:bg-gray-100">
                  <label class="flex items-center whitespace-nowrap">
                    <input type="checkbox" x-model="betForm.dateUnknown" 
                           @change="if($event.target.checked) betForm.testDate = ''"
                           class="mr-2 rounded border-gray-300">
                    <span class="text-sm">Unknown</span>
                  </label>
                </div>
              </div>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Graphene Sample</label>
                <select x-model="betForm.grapheneSample" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
                  <option value="">Select graphene sample...</option>
                  <template x-for="exp in availableGrapheneSamples" :key="exp">
                    <option :value="exp" x-text="exp"></option>
                  </template>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Species</label>
                <select x-model="betForm.species" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
                  <option value="">Select species...</option>
                  <template x-for="spec in species" :key="spec">
                    <option :value="spec" x-text="spec"></option>
                  </template>
                </select>
              </div>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Multipoint BET Area (m²/g)</label>
                <input type="text" x-model="betForm.multipointBetArea" 
                       placeholder="1.520e3 or 1520"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
                <p class="text-xs text-gray-500 mt-1">Scientific notation: 1.520e3 = 1.520 × 10³</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Langmuir Surface Area (m²/g)</label>
                <input type="text" x-model="betForm.langmuirSurfaceArea" 
                       placeholder="2.340e3 or 2340"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
                <p class="text-xs text-gray-500 mt-1">Scientific notation: 2.340e3 = 2.340 × 10³</p>
              </div>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Comments</label>
              <textarea x-model="betForm.comments" rows="3"
                        placeholder="Additional notes about the BET analysis..."
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black"></textarea>
            </div>
            
            <div class="flex justify-end space-x-3">
              <button type="button" @click="showAddBet = false; editingBet = null; betForm = {}" 
                      class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">
                Cancel
              </button>
              <button type="submit" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">
                <span x-text="editingBet ? 'Update' : 'Create'"></span> Record
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <!-- SEM Report Modal -->
    <div x-show="showSemModal" x-cloak
         @click.away="closeSemModal()"
         class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-4xl w-full h-[90vh] p-6">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold">SEM Report</h3>
            <button @click="closeSemModal()" class="text-gray-400 hover:text-gray-600">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
          <div class="h-full">
            <iframe x-show="currentSemPdf" 
                    :src="currentSemPdf" 
                    class="w-full h-full border rounded"
                    title="SEM Report PDF">
            </iframe>
          </div>
        </div>
      </div>
    </div>

    <!-- Add New Research Team Modal -->
    <div x-show="showAddResearchTeam" x-cloak
         @click.away="showAddResearchTeam = false; newResearchTeam = ''"
         class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black opacity-50"></div>
        <div class="relative bg-white rounded-lg max-w-md w-full p-6">
          <h3 class="text-lg font-semibold mb-4">Add New Research Team</h3>
          <form @submit.prevent="addNewResearchTeam()" class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Team Name</label>
              <input type="text" x-model="newResearchTeam" required
                     class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-black">
            </div>
            <div class="flex justify-end space-x-2">
              <button type="button" @click="showAddResearchTeam = false; newResearchTeam = ''"
                      class="px-4 py-2 text-sm border border-gray-300 rounded hover:bg-gray-50">
                Cancel
              </button>
              <button type="submit" class="px-4 py-2 text-sm bg-black text-white rounded hover:bg-gray-800">
                Add Team
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
  </div>

  <!-- Use modules for better code organization -->
  <script type="module" src="/src/js/app-refactored.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</body>
</html>